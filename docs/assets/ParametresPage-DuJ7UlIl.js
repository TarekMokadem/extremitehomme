import{c as G,a as v,r as T,s as F,d as Q,Q as I,C as $,e as w,f as r,j as p,l as h,g as l,R as J,n as K,F as W,k as H,t as X,y as u,z as g,p as Y,q as E}from"./index-Bl-DGyDc.js";import{a as j,I as A,b as B,S as L,P as Z}from"./formatInputs-COkqqkP5.js";import{R as D}from"./refresh-cw-DCDDjdqj.js";const _=G("building-2",[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]]),S={salon_info:{name:"Extrémités Homme",address:"",phone:"",siret:""},tva_rates:{normal:.2,reduced:.1,super_reduced:.055},ticket_header:{line1:"Extrémités Homme",line2:"",line3:""},ticket_footer:{line1:"Merci de votre visite !",line2:""},loyalty:{points_per_euro:1,euros_per_point:.01,enabled:!1}},U=T({}),M=T(!1),P=T(!1);function ee(){const N=async()=>{M.value=!0;try{const{data:o,error:a}=await F.from("settings").select("key, value");if(a)throw a;const s={};(o||[]).forEach(d=>{s[d.key]=d.value}),Object.keys(S).forEach(d=>{s[d]==null&&(s[d]=S[d])}),U.value=s}catch(o){console.error("Erreur chargement paramètres:",o),Object.keys(S).forEach(a=>{U.value[a]=S[a]})}finally{M.value=!1}},V=async(o,a)=>{P.value=!0;try{const{error:s}=await F.from("settings").upsert({key:o,value:a,updated_at:new Date().toISOString()},{onConflict:"key"});if(s)throw s;U.value[o]=a}catch(s){throw console.error("Erreur sauvegarde paramètre:",s),s}finally{P.value=!1}},n=o=>{const a=U.value[o];return a??S[o]??{}},b=v(()=>n("salon_info")),c=v(()=>n("tva_rates")),f=v(()=>n("ticket_header")),C=v(()=>n("ticket_footer")),k=v(()=>n("loyalty"));return{loadSettings:N,saveSetting:V,get:n,salonInfo:b,tvaRates:c,ticketHeader:f,ticketFooter:C,loyaltyConfig:k,isLoading:M,isSaving:P}}const re={class:"flex-1 p-4 lg:p-6 overflow-auto bg-gray-50 dark:bg-gray-900"},ae={class:"max-w-2xl mx-auto space-y-6"},te={class:"flex items-center justify-between"},se={class:"text-xl lg:text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2"},le=["disabled"],de={key:0,class:"flex justify-center py-12"},oe={key:0,class:"text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/30 px-4 py-2 rounded-xl"},ne={key:1,class:"text-sm text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/30 px-4 py-2 rounded-xl"},ie={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},ue={class:"px-5 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center gap-2"},ge={class:"p-5 space-y-4"},ye=["value","maxlength"],pe=["value","maxlength"],me=["disabled"],xe={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},be={class:"px-5 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center gap-2"},ce={class:"p-5 space-y-4"},fe=["disabled"],ke={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},ve={class:"px-5 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center gap-2"},we={class:"p-5 space-y-4"},he={class:"pt-2 border-t border-gray-100 dark:border-gray-700"},Ee=["disabled"],Ce=Q({__name:"ParametresPage",setup(N){const{loadSettings:V,saveSetting:n,salonInfo:b,tvaRates:c,ticketHeader:f,ticketFooter:C,isLoading:k,isSaving:o}=ee(),a=I({name:"",address:"",phone:"",siret:""}),s=I({normal:.2,reduced:.1,super_reduced:.055}),d=I({line1:"",line2:"",line3:""}),m=I({line1:"",line2:""}),i=T(!1),x=T("");function R(){a.name=b.value.name,a.address=b.value.address,a.phone=j(b.value.phone||""),a.siret=B(b.value.siret||""),s.normal=c.value.normal,s.reduced=c.value.reduced,s.super_reduced=c.value.super_reduced,d.line1=f.value.line1,d.line2=f.value.line2??"",d.line3=f.value.line3??"",m.line1=C.value.line1,m.line2=C.value.line2??""}async function O(){x.value="",i.value=!1;try{await n("salon_info",{...a}),i.value=!0,setTimeout(()=>i.value=!1,2500)}catch(y){x.value=y instanceof Error?y.message:"Erreur lors de l'enregistrement"}}async function q(){x.value="",i.value=!1;try{await n("tva_rates",{...s}),i.value=!0,setTimeout(()=>i.value=!1,2500)}catch(y){x.value=y instanceof Error?y.message:"Erreur lors de l'enregistrement"}}async function z(){x.value="",i.value=!1;try{await n("ticket_header",{line1:d.line1,line2:d.line2,line3:d.line3}),await n("ticket_footer",{line1:m.line1,line2:m.line2}),i.value=!0,setTimeout(()=>i.value=!1,2500)}catch(y){x.value=y instanceof Error?y.message:"Erreur lors de l'enregistrement"}}return $(async()=>{await V(),R()}),(y,e)=>(E(),w("main",re,[r("div",ae,[r("div",te,[r("div",null,[r("h1",se,[p(l(J),{class:"w-7 h-7 text-gray-600 dark:text-gray-400"}),e[13]||(e[13]=h(" Paramètres ",-1))]),e[14]||(e[14]=r("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"Informations du commerce et des tickets",-1))]),r("button",{onClick:e[0]||(e[0]=t=>{l(V)(),R()}),disabled:l(k),class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-xl hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50"},[p(l(D),{class:K(["w-4 h-4",l(k)&&"animate-spin"])},null,8,["class"]),e[15]||(e[15]=h(" Actualiser ",-1))],8,le)]),l(k)?(E(),w("div",de,[p(l(D),{class:"w-8 h-8 text-gray-400 dark:text-gray-500 animate-spin"})])):(E(),w(W,{key:1},[x.value?(E(),w("p",oe,X(x.value),1)):H("",!0),i.value?(E(),w("p",ne," Paramètres enregistrés. ")):H("",!0),r("section",ie,[r("div",ue,[p(l(_),{class:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e[16]||(e[16]=r("h2",{class:"font-semibold text-gray-900 dark:text-white"},"Informations du salon",-1))]),r("div",ge,[r("div",null,[e[17]||(e[17]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Nom du commerce",-1)),u(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.name=t),type:"text",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent",placeholder:"Extrémités Homme"},null,512),[[g,a.name]])]),r("div",null,[e[18]||(e[18]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Adresse",-1)),u(r("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>a.address=t),type:"text",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent",placeholder:"123 rue Example"},null,512),[[g,a.address]])]),r("div",null,[e[19]||(e[19]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Téléphone",-1)),r("input",{value:a.phone,type:"tel",inputmode:"numeric",autocomplete:"tel",maxlength:l(A).phone,placeholder:"01 23 45 67 89",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent",onInput:e[3]||(e[3]=t=>a.phone=l(j)(t.target.value))},null,40,ye)]),r("div",null,[e[20]||(e[20]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"SIRET",-1)),r("input",{value:a.siret,type:"text",inputmode:"numeric",maxlength:l(A).siret,placeholder:"123 456 789 00012",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent",onInput:e[4]||(e[4]=t=>a.siret=l(B)(t.target.value))},null,40,pe)]),r("button",{onClick:O,disabled:l(o),class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 dark:bg-emerald-600 dark:hover:bg-emerald-500 text-white rounded-xl hover:bg-gray-800 disabled:opacity-50"},[p(l(L),{class:"w-4 h-4"}),e[21]||(e[21]=h(" Enregistrer ",-1))],8,me)])]),r("section",xe,[r("div",be,[p(l(Z),{class:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e[22]||(e[22]=r("h2",{class:"font-semibold text-gray-900 dark:text-white"},"Taux de TVA",-1))]),r("div",ce,[e[30]||(e[30]=r("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," Ces taux sont utilisés pour l’affichage et les calculs. Le taux normal s’applique par défaut aux services. ",-1)),r("div",null,[e[23]||(e[23]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Taux normal (%)",-1)),u(r("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>s.normal=t),type:"number",min:"0",max:"1",step:"0.01",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent"},null,512),[[g,s.normal,void 0,{number:!0}]]),e[24]||(e[24]=r("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"Ex. 0,20 pour 20 %",-1))]),r("div",null,[e[25]||(e[25]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Taux réduit (%)",-1)),u(r("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>s.reduced=t),type:"number",min:"0",max:"1",step:"0.01",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent"},null,512),[[g,s.reduced,void 0,{number:!0}]]),e[26]||(e[26]=r("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"Ex. 0,10 pour 10 %",-1))]),r("div",null,[e[27]||(e[27]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Taux super réduit (%)",-1)),u(r("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>s.super_reduced=t),type:"number",min:"0",max:"1",step:"0.01",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent"},null,512),[[g,s.super_reduced,void 0,{number:!0}]]),e[28]||(e[28]=r("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"Ex. 0,055 pour 5,5 %",-1))]),r("button",{onClick:q,disabled:l(o),class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 dark:bg-emerald-600 dark:hover:bg-emerald-500 text-white rounded-xl hover:bg-gray-800 disabled:opacity-50"},[p(l(L),{class:"w-4 h-4"}),e[29]||(e[29]=h(" Enregistrer ",-1))],8,fe)])]),r("section",ke,[r("div",ve,[p(l(Y),{class:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e[31]||(e[31]=r("h2",{class:"font-semibold text-gray-900 dark:text-white"},"Ticket — En-tête et pied de page",-1))]),r("div",we,[e[38]||(e[38]=r("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," Texte affiché en haut et en bas du ticket (impression ou aperçu). ",-1)),r("div",null,[e[32]||(e[32]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"En-tête — Ligne 1",-1)),u(r("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>d.line1=t),type:"text",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent",placeholder:"Nom du salon"},null,512),[[g,d.line1]])]),r("div",null,[e[33]||(e[33]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"En-tête — Ligne 2",-1)),u(r("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>d.line2=t),type:"text",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent",placeholder:"Adresse ou téléphone"},null,512),[[g,d.line2]])]),r("div",null,[e[34]||(e[34]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"En-tête — Ligne 3",-1)),u(r("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>d.line3=t),type:"text",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent",placeholder:"SIRET ou autre"},null,512),[[g,d.line3]])]),r("div",he,[e[35]||(e[35]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Pied de page — Ligne 1",-1)),u(r("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>m.line1=t),type:"text",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent",placeholder:"Merci de votre visite !"},null,512),[[g,m.line1]])]),r("div",null,[e[36]||(e[36]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Pied de page — Ligne 2",-1)),u(r("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>m.line2=t),type:"text",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 rounded-xl focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent",placeholder:""},null,512),[[g,m.line2]])]),r("button",{onClick:z,disabled:l(o),class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 dark:bg-emerald-600 dark:hover:bg-emerald-500 text-white rounded-xl hover:bg-gray-800 disabled:opacity-50"},[p(l(L),{class:"w-4 h-4"}),e[37]||(e[37]=h(" Enregistrer ",-1))],8,Ee)])])],64))])]))}});export{Ce as default};
