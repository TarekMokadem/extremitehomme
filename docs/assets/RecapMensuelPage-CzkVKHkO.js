import{d as X,r as y,a as l,e as d,f as t,k as P,j as p,l as R,g as c,z as Z,G as tt,F as x,h as b,m as V,Q as et,t as s,U as rt,s as at,n as st,v as n}from"./index-8JeweAIN.js";import{P as ot}from"./printer-9ObaF-he.js";import{R as j}from"./refresh-cw--HoeajCP.js";import{T as nt}from"./trending-up-BRimrD71.js";import{R as q}from"./receipt-DBVjBL_P.js";import{S as dt}from"./shopping-cart-B2hjwKw0.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const it={class:"flex-1 p-4 lg:p-6 overflow-auto bg-gray-50 dark:bg-gray-900 print:bg-white print:p-4"},ct={class:"max-w-6xl mx-auto space-y-6 print:max-w-none"},gt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 print:flex-row"},ut={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 space-y-4 print:hidden"},pt={class:"flex flex-wrap items-center gap-3"},xt=["value"],mt={class:"flex flex-wrap gap-2"},yt=["onClick"],bt=["disabled"],ht={class:"hidden print:block text-center mb-4"},ft={class:"text-lg font-bold"},_t={key:0,class:"flex justify-center py-12"},kt={class:"grid grid-cols-2 lg:grid-cols-4 gap-4 print:grid-cols-4"},vt={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 print:rounded-none print:shadow-none"},wt={class:"flex items-center gap-2 mb-1"},St={class:"text-2xl font-bold text-gray-900 dark:text-white print:text-black"},$t={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 print:rounded-none print:shadow-none"},Ct={class:"flex items-center gap-2 mb-1"},Mt={class:"text-2xl font-bold text-gray-900 dark:text-white print:text-black"},Tt={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 print:rounded-none print:shadow-none"},Dt={class:"flex items-center gap-2 mb-1"},At={class:"text-2xl font-bold text-gray-900 dark:text-white print:text-black"},Nt={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 print:rounded-none print:shadow-none"},Pt={class:"flex items-center gap-2 mb-1"},Rt={class:"text-2xl font-bold text-gray-900 dark:text-white print:text-black"},Vt={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden print:rounded-none print:border print:shadow-none"},jt={class:"w-full text-sm"},qt={class:"divide-y divide-gray-100 dark:divide-gray-700"},Et={class:"px-4 py-2"},Ft={class:"px-4 py-2 text-right tabular-nums"},Ot={class:"px-4 py-2 text-right tabular-nums"},Bt={class:"font-bold bg-gray-50 dark:bg-gray-700/50 border-t-2 border-gray-200 dark:border-gray-600"},Jt={class:"px-4 py-2 text-right tabular-nums"},Lt={class:"px-4 py-2 text-right tabular-nums"},Ht={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden print:rounded-none print:border print:shadow-none"},Yt={class:"px-4 py-3 bg-gray-100 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"},zt={class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider"},Ut={key:0,class:"p-8 text-center"},Gt={key:1,class:"overflow-x-auto journal-content print-thermal-compact"},It={class:"w-full text-sm min-w-[900px]"},Qt={class:"bg-gray-100 dark:bg-gray-700/60"},Kt={colspan:"8",class:"px-3 py-2 font-semibold text-gray-800 dark:text-gray-200 text-xs uppercase tracking-wider"},Wt={class:"px-3 py-2 tabular-nums"},Xt={class:"px-3 py-2 tabular-nums"},Zt={class:"px-3 py-2 font-mono text-xs"},te={class:"px-3 py-2"},ee={class:"px-3 py-2"},re=["title"],ae={class:"px-3 py-2"},se={class:"px-3 py-2 text-right tabular-nums font-medium"},oe={class:"bg-gray-50 dark:bg-gray-700/30 border-b-2 border-gray-200 dark:border-gray-600"},ne={colspan:"7",class:"px-3 py-2 text-right text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider"},de={class:"px-3 py-2 text-right tabular-nums font-bold text-gray-900 dark:text-white"},le={class:"bg-gray-900 dark:bg-emerald-900/40"},ie={colspan:"7",class:"px-3 py-3 text-right font-bold text-white dark:text-emerald-300 uppercase tracking-wider text-sm"},ce={class:"px-3 py-3 text-right tabular-nums font-bold text-white dark:text-emerald-300 text-lg"},ge=X({__name:"RecapMensuelPage",setup(ue){const _={cash:"Espèces",card:"CB",contactless:"Sans contact",amex:"Amex",check:"Chèque",gift_card:"Chèque Cadeau",free:"Gratuit",technical:"Technique"},k=Object.keys(_),E=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],F=["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"],T=new Date,h=y(T.getFullYear()),f=y(T.getMonth()),m=y(!1),i=y([]),v=y(!1),O=l(()=>{const r=new Date().getFullYear();return[r-2,r-1,r,r+1]}),w=l(()=>`${E[f.value]} ${h.value}`),S=l(()=>i.value.reduce((r,e)=>r+e.total,0)),$=l(()=>i.value.length),B=l(()=>$.value>0?S.value/$.value:0),J=l(()=>{const r=new Set;for(const e of i.value)e.client&&r.add(`${e.client.first_name}_${e.client.last_name}`);return r.size}),C=l(()=>{const r={};for(const e of k)r[e]={amount:0,count:0};for(const e of i.value)if(e.payments)for(const a of e.payments)r[a.method]||(r[a.method]={amount:0,count:0}),r[a.method].amount+=a.amount,r[a.method].count++;return k.map(e=>({method:e,label:_[e]??e,amount:r[e]?.amount??0,count:r[e]?.count??0})).filter(e=>e.count>0||k.includes(e.method))}),L=l(()=>C.value.reduce((r,e)=>r+e.amount,0)),H=l(()=>C.value.reduce((r,e)=>r+e.count,0)),Y=l(()=>{const r=new Map;for(const a of i.value){const o=D(a.created_at);r.has(o)||r.set(o,[]),r.get(o).push(a)}const e=[];for(const[a,o]of r)e.push({date:a,label:a,sales:o,subtotal:o.reduce((g,M)=>g+M.total,0)});return e});function D(r){const e=new Date(r);return`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`}function z(r){const e=new Date(r);return`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function u(r){return r.toFixed(2)}function U(r){return!r||r.length===0?"—":r.map(e=>_[e.method]??e.method).join(", ")}function A(r){return!r||r.length===0?"—":r.map(e=>`${e.quantity}x ${e.product_name}`).join(", ")}function G(r){return r&&`${r.first_name} ${r.last_name}`.trim()||"—"}function I(r){return r&&`${r.first_name} ${r.last_name}`.trim()||"—"}function Q(r){const e=r.items||[],a=new Set;for(const o of e){const g=o.vendor;g&&a.add(`${g.first_name} ${g.last_name}`.trim())}return a.size===0?I(r.vendor):Array.from(a).join(", ")}async function K(){m.value=!0;try{const r=h.value,e=f.value,a=`${r}-${String(e+1).padStart(2,"0")}-01`,o=new Date(r,e+1,0).getDate(),g=`${r}-${String(e+1).padStart(2,"0")}-${String(o).padStart(2,"0")}`,{data:M,error:N}=await at.from("sales").select(`
        id, ticket_number, total, discount_amount, created_at,
        client:clients(first_name, last_name),
        vendor:vendors(first_name, last_name),
        items:sale_items(id, product_name, quantity, subtotal_ttc, vendor:vendors(first_name, last_name)),
        payments:payments(method, amount)
      `).gte("created_at",`${a}T00:00:00`).lte("created_at",`${g}T23:59:59`).eq("status","completed").order("created_at");if(N)throw N;i.value=M||[]}catch(r){console.error("Erreur chargement recap mensuel:",r),i.value=[]}finally{m.value=!1,v.value=!0}}function W(){window.print()}return(r,e)=>(n(),d("main",it,[t("div",ct,[t("div",gt,[e[2]||(e[2]=t("h1",{class:"text-xl lg:text-2xl font-bold text-gray-900 dark:text-white print:text-black"}," Récapitulatif Mensuel ",-1)),v.value&&i.value.length>0?(n(),d("button",{key:0,onClick:W,class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 dark:bg-emerald-600 text-white rounded-xl hover:bg-gray-800 dark:hover:bg-emerald-500 transition-colors print:hidden"},[p(c(ot),{class:"w-4 h-4"}),e[1]||(e[1]=R(" Imprimer ",-1))])):P("",!0)]),t("div",ut,[t("div",pt,[e[3]||(e[3]=t("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Année :",-1)),Z(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),class:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-900/10 dark:focus:ring-emerald-500/30"},[(n(!0),d(x,null,b(O.value,a=>(n(),d("option",{key:a,value:a},s(a),9,xt))),128))],512),[[tt,h.value,void 0,{number:!0}]])]),t("div",mt,[(n(),d(x,null,b(F,(a,o)=>t("button",{key:o,onClick:g=>f.value=o,class:st(["px-3 py-2 text-sm font-medium rounded-xl transition-colors",f.value===o?"bg-gray-900 dark:bg-emerald-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},s(a),11,yt)),64))]),t("button",{onClick:K,disabled:m.value,class:"inline-flex items-center gap-2 px-5 py-2.5 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 disabled:opacity-50 transition-colors font-medium"},[m.value?(n(),V(c(j),{key:1,class:"w-4 h-4 animate-spin"})):(n(),V(c(et),{key:0,class:"w-4 h-4"})),e[4]||(e[4]=R(" Calculer ",-1))],8,bt)]),t("div",ht,[t("p",ft,s(w.value),1)]),m.value?(n(),d("div",_t,[p(c(j),{class:"w-8 h-8 text-gray-400 animate-spin"})])):v.value?(n(),d(x,{key:1},[t("div",kt,[t("div",vt,[t("div",wt,[p(c(nt),{class:"w-4 h-4 text-emerald-500"}),e[5]||(e[5]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold"},"Total CA",-1))]),t("p",St,s(u(S.value))+" €",1)]),t("div",$t,[t("div",Ct,[p(c(q),{class:"w-4 h-4 text-blue-500"}),e[6]||(e[6]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold"},"Ventes",-1))]),t("p",Mt,s($.value),1)]),t("div",Tt,[t("div",Dt,[p(c(dt),{class:"w-4 h-4 text-orange-500"}),e[7]||(e[7]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold"},"Panier moyen",-1))]),t("p",At,s(u(B.value))+" €",1)]),t("div",Nt,[t("div",Pt,[p(c(rt),{class:"w-4 h-4 text-purple-500"}),e[8]||(e[8]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold"},"Clients uniques",-1))]),t("p",Rt,s(J.value),1)])]),t("div",Vt,[e[11]||(e[11]=t("div",{class:"px-4 py-3 bg-gray-100 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"},[t("h2",{class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider"},"Récapitulatif par mode de règlement")],-1)),t("table",jt,[e[10]||(e[10]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-600"},[t("th",{class:"px-4 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Mode de règlement"),t("th",{class:"px-4 py-2 text-right font-semibold text-gray-700 dark:text-gray-300"},"Montant"),t("th",{class:"px-4 py-2 text-right font-semibold text-gray-700 dark:text-gray-300"},"Nb")])],-1)),t("tbody",qt,[(n(!0),d(x,null,b(C.value,a=>(n(),d("tr",{key:a.method,class:"text-gray-900 dark:text-gray-100"},[t("td",Et,s(a.label),1),t("td",Ft,s(u(a.amount))+" €",1),t("td",Ot,s(a.count),1)]))),128)),t("tr",Bt,[e[9]||(e[9]=t("td",{class:"px-4 py-2"},"Total",-1)),t("td",Jt,s(u(L.value))+" €",1),t("td",Lt,s(H.value),1)])])])]),t("div",Ht,[t("div",Yt,[t("h2",zt," Journal des ventes — "+s(w.value),1)]),i.value.length===0?(n(),d("div",Ut,[p(c(q),{class:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto"}),e[12]||(e[12]=t("p",{class:"text-gray-500 dark:text-gray-400 mt-2"},"Aucune vente pour ce mois",-1))])):(n(),d("div",Gt,[t("table",It,[e[13]||(e[13]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-600"},[t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Date"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Heure"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Ticket"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Client"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Vendeur"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Articles"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Paiement"),t("th",{class:"px-3 py-2 text-right font-semibold text-gray-700 dark:text-gray-300"},"Total")])],-1)),t("tbody",null,[(n(!0),d(x,null,b(Y.value,a=>(n(),d(x,{key:a.date},[t("tr",Qt,[t("td",Kt,s(a.label),1)]),(n(!0),d(x,null,b(a.sales,o=>(n(),d("tr",{key:o.id,class:"text-gray-900 dark:text-gray-100 border-b border-gray-50 dark:border-gray-700/40 hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors"},[t("td",Wt,s(D(o.created_at)),1),t("td",Xt,s(z(o.created_at)),1),t("td",Zt,s(o.ticket_number),1),t("td",te,s(G(o.client)),1),t("td",ee,s(Q(o)),1),t("td",{class:"px-3 py-2 max-w-[200px] truncate",title:A(o.items)},s(A(o.items)),9,re),t("td",ae,s(U(o.payments)),1),t("td",se,s(u(o.total))+" €",1)]))),128)),t("tr",oe,[t("td",ne," Sous-total "+s(a.label),1),t("td",de,s(u(a.subtotal))+" € ",1)])],64))),128)),t("tr",le,[t("td",ie," Total "+s(w.value),1),t("td",ce,s(u(S.value))+" € ",1)])])])]))])],64)):P("",!0)])]))}}),_e=lt(ge,[["__scopeId","data-v-971db7cc"]]);export{_e as default};
