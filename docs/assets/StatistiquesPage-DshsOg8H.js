import{c as N,d as lt,r as g,a as I,y as rt,b as l,e as t,h as _,n as O,f as u,F as D,j as R,l as J,k as F,m as U,t as o,A as it,U as ct,g as M,s as x,B as E,o as n}from"./index-DodYGpJ8.js";import{R as W}from"./refresh-cw-C5BCTzhv.js";import{E as dt}from"./euro-_aVnEfKE.js";import{S as ut}from"./shopping-bag-Cf2Hlekb.js";import{C as mt}from"./clock-DXDJg47w.js";const gt=N("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);const z=N("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);const G=N("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),xt={class:"flex-1 p-4 lg:p-6 overflow-auto bg-gray-50"},_t={class:"max-w-7xl mx-auto space-y-6"},ht={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},pt=["disabled"],vt={key:0,class:"flex items-center justify-center py-20"},yt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},ft={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},wt={class:"flex items-center justify-between mb-3"},bt={class:"w-10 h-10 rounded-xl bg-emerald-100 flex items-center justify-center"},kt={class:"text-2xl font-bold text-gray-900"},Tt={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},St={class:"flex items-center justify-between mb-3"},Dt={class:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center"},jt={class:"text-2xl font-bold text-gray-900"},$t={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},Ct={class:"flex items-center justify-between mb-3"},qt={class:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center"},At={class:"text-2xl font-bold text-gray-900"},It={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},Ot={class:"flex items-center justify-between mb-3"},Ft={class:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center"},Mt={class:"text-2xl font-bold text-gray-900"},Lt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Bt={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},Vt={class:"space-y-3"},Rt={class:"w-16 text-xs text-gray-500 shrink-0"},Et={class:"flex-1 h-8 bg-gray-100 rounded-lg overflow-hidden relative"},Nt={key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs font-semibold text-gray-700"},Pt={class:"w-12 text-xs text-gray-400 text-right shrink-0"},Jt={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},Ut={class:"text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4 flex items-center gap-2"},Wt={key:0,class:"text-center py-8 text-gray-500"},zt={key:1,class:"space-y-3"},Gt={class:"flex-1 min-w-0"},Ht={class:"text-sm font-medium text-gray-900 truncate"},Kt={class:"h-2 bg-gray-100 rounded-full mt-1 overflow-hidden"},Qt={class:"text-right shrink-0"},Xt={class:"text-sm font-bold text-gray-900"},Yt={class:"text-xs text-gray-500"},Zt={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},te={key:0,class:"text-center py-8 text-gray-500"},ee={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},se={class:"flex-1 min-w-0"},ae={class:"font-semibold text-gray-900 truncate"},oe={class:"text-sm text-gray-500"},ne={class:"text-right"},le={class:"text-lg font-bold text-gray-900"},re={class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"},ie={class:"p-5 border-b border-gray-200 flex items-center justify-between"},ce={class:"text-sm font-semibold text-gray-900 uppercase tracking-wider flex items-center gap-2"},de={class:"text-sm text-gray-500"},ue={key:0,class:"p-8 text-center text-gray-500"},me={key:1,class:"divide-y divide-gray-100 max-h-96 overflow-y-auto"},ge={class:"w-14 text-center shrink-0"},xe={class:"text-sm font-semibold text-gray-900"},_e={class:"flex-1 min-w-0"},he={class:"text-sm font-medium text-gray-900 truncate"},pe={class:"text-xs text-gray-500"},ve={class:"text-lg font-bold text-gray-900 shrink-0"},Se=lt({__name:"StatistiquesPage",setup(ye){const y=g(!0),f=g({total:0,count:0,avgTicket:0}),L=g({total:0,count:0,avgTicket:0}),H=g({total:0,count:0,avgTicket:0}),j=g(0),$=g(0),B=g([]),w=g([]),C=g([]),b=g([]),q=I(()=>j.value===0?0:(f.value.total-j.value)/j.value*100),A=I(()=>$.value===0?0:(L.value.total-$.value)/$.value*100),K=I(()=>Math.max(...B.value.map(a=>a.total),1)),Q=I(()=>Math.max(...w.value.map(a=>a.count),1)),P=async()=>{y.value=!0;try{const a=new Date,s=a.toISOString().split("T")[0],e=new Date(a.getTime()-1440*60*1e3).toISOString().split("T")[0],r=new Date(a.getTime()-10080*60*1e3).toISOString().split("T")[0],d=new Date(a.getTime()-336*60*60*1e3).toISOString().split("T")[0],p=new Date(a.getTime()-720*60*60*1e3).toISOString().split("T")[0],{data:v}=await x.from("sales").select("total").gte("created_at",`${s}T00:00:00`).eq("status","completed"),m=v||[];f.value={total:m.reduce((i,c)=>i+c.total,0),count:m.length,avgTicket:m.length>0?m.reduce((i,c)=>i+c.total,0)/m.length:0};const{data:k}=await x.from("sales").select("total").gte("created_at",`${e}T00:00:00`).lt("created_at",`${s}T00:00:00`).eq("status","completed");j.value=(k||[]).reduce((i,c)=>i+c.total,0);const{data:V}=await x.from("sales").select("total").gte("created_at",`${r}T00:00:00`).eq("status","completed"),T=V||[];L.value={total:T.reduce((i,c)=>i+c.total,0),count:T.length,avgTicket:T.length>0?T.reduce((i,c)=>i+c.total,0)/T.length:0};const{data:ot}=await x.from("sales").select("total").gte("created_at",`${d}T00:00:00`).lt("created_at",`${r}T00:00:00`).eq("status","completed");$.value=(ot||[]).reduce((i,c)=>i+c.total,0);const{data:nt}=await x.from("sales").select("total").gte("created_at",`${p}T00:00:00`).eq("status","completed"),S=nt||[];H.value={total:S.reduce((i,c)=>i+c.total,0),count:S.length,avgTicket:S.length>0?S.reduce((i,c)=>i+c.total,0)/S.length:0},await X(),await Y(),await Z(),await tt()}catch(a){console.error("Erreur chargement stats:",a)}finally{y.value=!1}},X=async()=>{const a=[],s=new Date;for(let e=6;e>=0;e--){const r=new Date(s.getTime()-e*24*60*60*1e3),d=r.toISOString().split("T")[0],p=new Date(r.getTime()+1440*60*1e3).toISOString().split("T")[0],{data:v}=await x.from("sales").select("total").gte("created_at",`${d}T00:00:00`).lt("created_at",`${p}T00:00:00`).eq("status","completed"),m=v||[];a.push({date:d,total:m.reduce((k,V)=>k+V.total,0),count:m.length})}B.value=a},Y=async()=>{const{data:a}=await x.from("sale_items").select("product_name, quantity, subtotal_ttc");if(!a){w.value=[];return}const s=new Map;for(const e of a){const r=s.get(e.product_name);r?(r.count+=e.quantity,r.revenue+=e.subtotal_ttc):s.set(e.product_name,{name:e.product_name,count:e.quantity,revenue:e.subtotal_ttc})}w.value=Array.from(s.values()).sort((e,r)=>r.count-e.count).slice(0,5)},Z=async()=>{const{data:a}=await x.from("vendors").select("id, first_name, last_name, initials, color").eq("is_active",!0);if(!a){C.value=[];return}const s=new Date,e=new Date(s.getTime()-720*60*60*1e3).toISOString().split("T")[0],r=[];for(const d of a){const{data:p}=await x.from("sales").select("total").eq("vendor_id",d.id).gte("created_at",`${e}T00:00:00`).eq("status","completed"),v=p||[];r.push({id:d.id,name:`${d.first_name} ${d.last_name}`,initials:d.initials??"",color:d.color??"#6B7280",total:v.reduce((m,k)=>m+k.total,0),count:v.length})}C.value=r.sort((d,p)=>p.total-d.total)},tt=async()=>{const a=new Date().toISOString().split("T")[0],{data:s}=await x.from("sales").select(`
      id,
      ticket_number,
      total,
      created_at,
      client:clients(first_name, last_name),
      vendor:vendors(first_name, last_name),
      items:sale_items(id)
    `).gte("created_at",`${a}T00:00:00`).eq("status","completed").order("created_at",{ascending:!1});if(!s){b.value=[];return}b.value=s.map(e=>({id:e.id,ticket_number:e.ticket_number,total:e.total,created_at:e.created_at,client_name:e.client?`${e.client.first_name} ${e.client.last_name}`:null,vendor_name:e.vendor?`${e.vendor.first_name} ${e.vendor.last_name}`:"Inconnu",items_count:e.items?.length||0}))},h=a=>a.toFixed(2),et=a=>new Date(a).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric"}),st=a=>new Date(a).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),at=a=>new Date(a).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"});return rt(P),(a,s)=>(n(),l("main",xt,[t("div",_t,[t("div",ht,[s[1]||(s[1]=t("div",null,[t("h1",{class:"text-xl lg:text-2xl font-bold text-gray-900"},"Statistiques"),t("p",{class:"text-sm text-gray-500 mt-1"},"Vue d'ensemble de l'activité")],-1)),t("button",{onClick:P,disabled:y.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-xl hover:bg-gray-800 transition-colors disabled:opacity-50"},[_(u(W),{class:O(["w-4 h-4",y.value&&"animate-spin"])},null,8,["class"]),s[0]||(s[0]=t("span",null,"Actualiser",-1))],8,pt)]),y.value?(n(),l("div",vt,[_(u(W),{class:"w-8 h-8 text-gray-400 animate-spin"})])):(n(),l(D,{key:1},[t("div",yt,[t("div",ft,[t("div",wt,[t("div",bt,[_(u(dt),{class:"w-5 h-5 text-emerald-600"})]),q.value!==0?(n(),l("div",{key:0,class:O(["inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",q.value>0?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"])},[(n(),J(U(q.value>0?u(G):u(z)),{class:"w-3 h-3"})),F(" "+o(Math.abs(q.value).toFixed(0))+"% ",1)],2)):R("",!0)]),t("p",kt,o(h(f.value.total))+"€",1),s[2]||(s[2]=t("p",{class:"text-sm text-gray-500 mt-1"},"CA aujourd'hui",-1))]),t("div",Tt,[t("div",St,[t("div",Dt,[_(u(it),{class:"w-5 h-5 text-blue-600"})]),A.value!==0?(n(),l("div",{key:0,class:O(["inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",A.value>0?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"])},[(n(),J(U(A.value>0?u(G):u(z)),{class:"w-3 h-3"})),F(" "+o(Math.abs(A.value).toFixed(0))+"% ",1)],2)):R("",!0)]),t("p",jt,o(h(L.value.total))+"€",1),s[3]||(s[3]=t("p",{class:"text-sm text-gray-500 mt-1"},"CA cette semaine",-1))]),t("div",$t,[t("div",Ct,[t("div",qt,[_(u(ut),{class:"w-5 h-5 text-purple-600"})])]),t("p",At,o(f.value.count),1),s[4]||(s[4]=t("p",{class:"text-sm text-gray-500 mt-1"},"Ventes aujourd'hui",-1))]),t("div",It,[t("div",Ot,[t("div",Ft,[_(u(ct),{class:"w-5 h-5 text-amber-600"})])]),t("p",Mt,o(h(f.value.avgTicket))+"€",1),s[5]||(s[5]=t("p",{class:"text-sm text-gray-500 mt-1"},"Panier moyen",-1))])]),t("div",Lt,[t("div",Bt,[s[6]||(s[6]=t("h3",{class:"text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4"}," Chiffre d'affaires (7 derniers jours) ",-1)),t("div",Vt,[(n(!0),l(D,null,M(B.value,e=>(n(),l("div",{key:e.date,class:"flex items-center gap-3"},[t("span",Rt,o(et(e.date)),1),t("div",Et,[t("div",{class:"h-full bg-gradient-to-r from-emerald-500 to-emerald-400 rounded-lg transition-all duration-500",style:E({width:`${e.total/K.value*100}%`})},null,4),e.total>0?(n(),l("span",Nt,o(h(e.total))+"€ ",1)):R("",!0)]),t("span",Pt,o(e.count)+" v.",1)]))),128))])]),t("div",Jt,[t("h3",Ut,[_(u(gt),{class:"w-4 h-4 text-amber-500"}),s[7]||(s[7]=F(" Top 5 Services ",-1))]),w.value.length===0?(n(),l("div",Wt," Aucune donnée ")):(n(),l("div",zt,[(n(!0),l(D,null,M(w.value,(e,r)=>(n(),l("div",{key:e.name,class:"flex items-center gap-3"},[t("span",{class:O(["w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold",r===0?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-500"])},o(r+1),3),t("div",Gt,[t("p",Ht,o(e.name),1),t("div",Kt,[t("div",{class:"h-full bg-gradient-to-r from-purple-500 to-purple-400 rounded-full",style:E({width:`${e.count/Q.value*100}%`})},null,4)])]),t("div",Qt,[t("p",Xt,o(e.count),1),t("p",Yt,o(h(e.revenue))+"€",1)])]))),128))]))])]),t("div",Zt,[s[8]||(s[8]=t("h3",{class:"text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4"}," Performance vendeurs (30 derniers jours) ",-1)),C.value.length===0?(n(),l("div",te," Aucune donnée ")):(n(),l("div",ee,[(n(!0),l(D,null,M(C.value,e=>(n(),l("div",{key:e.id,class:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl"},[t("div",{style:E({backgroundColor:e.color}),class:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold"},o(e.initials),5),t("div",se,[t("p",ae,o(e.name),1),t("p",oe,o(e.count)+" ventes",1)]),t("div",ne,[t("p",le,o(h(e.total))+"€",1)])]))),128))]))]),t("div",re,[t("div",ie,[t("h3",ce,[_(u(mt),{class:"w-4 h-4"}),F(" Journal des ventes — "+o(at(new Date().toISOString())),1)]),t("span",de,o(b.value.length)+" ventes",1)]),b.value.length===0?(n(),l("div",ue," Aucune vente aujourd'hui ")):(n(),l("div",me,[(n(!0),l(D,null,M(b.value,e=>(n(),l("div",{key:e.id,class:"px-5 py-3 flex items-center gap-4 hover:bg-gray-50 transition-colors"},[t("div",ge,[t("p",xe,o(st(e.created_at)),1)]),t("div",_e,[t("p",he,o(e.client_name||"Client anonyme"),1),t("p",pe,o(e.ticket_number)+" · "+o(e.items_count)+" article(s) · "+o(e.vendor_name),1)]),t("p",ve,o(h(e.total))+"€",1)]))),128))]))])],64))])]))}});export{Se as default};
