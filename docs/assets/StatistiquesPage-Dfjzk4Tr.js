import{c as G,d as lt,r as m,a as M,D as dt,e as n,f as t,j as y,n as O,g as c,F as D,k as R,E as it,m as P,l as q,p as J,t as r,M as ct,U as ut,h as F,s as x,N as E,O as gt,q as o}from"./index-CmA_YBSG.js";import{R as U}from"./refresh-cw-DrNKGNc5.js";import{T as W}from"./trending-up-Cvd8hqb_.js";import{S as mt}from"./shopping-bag-D2AE6vFK.js";import{A as xt}from"./award-BHaxxwhY.js";import{C as yt}from"./clock-CmKNHITB.js";const ht=G("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const z=G("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),pt={class:"flex-1 p-4 lg:p-6 overflow-auto bg-gray-50 dark:bg-gray-900"},_t={class:"max-w-7xl mx-auto space-y-6"},vt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},bt=["disabled"],kt={key:0,class:"flex items-center justify-center py-20"},ft={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},wt={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},Tt={class:"flex items-center justify-between mb-3"},St={class:"w-10 h-10 rounded-xl bg-emerald-100 dark:bg-emerald-900/40 flex items-center justify-center"},Dt={class:"text-2xl font-bold text-gray-900 dark:text-white"},qt={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},$t={class:"flex items-center justify-between mb-3"},jt={class:"w-10 h-10 rounded-xl bg-blue-100 dark:bg-blue-900/40 flex items-center justify-center"},Ct={class:"text-2xl font-bold text-gray-900 dark:text-white"},At={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},It={class:"flex items-center justify-between mb-3"},Mt={class:"w-10 h-10 rounded-xl bg-purple-100 dark:bg-purple-900/40 flex items-center justify-center"},Ot={class:"text-2xl font-bold text-gray-900 dark:text-white"},Ft={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},Lt={class:"flex items-center justify-between mb-3"},Vt={class:"w-10 h-10 rounded-xl bg-amber-100 dark:bg-amber-900/40 flex items-center justify-center"},Bt={class:"text-2xl font-bold text-gray-900 dark:text-white"},Rt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Et={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},Nt={class:"space-y-3"},Pt={class:"w-16 text-xs text-gray-500 dark:text-gray-400 shrink-0"},Jt={class:"flex-1 h-8 bg-gray-100 dark:bg-gray-700 rounded-lg overflow-hidden relative"},Ut={key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs font-semibold text-gray-700 dark:text-gray-200"},Wt={class:"w-12 text-xs text-gray-400 dark:text-gray-500 text-right shrink-0"},zt={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},Gt={class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider mb-4 flex items-center gap-2"},Ht={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Kt={key:1,class:"space-y-3"},Qt={class:"flex-1 min-w-0"},Xt={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},Yt={class:"h-2 bg-gray-100 dark:bg-gray-700 rounded-full mt-1 overflow-hidden"},Zt={class:"text-right shrink-0"},te={class:"text-sm font-bold text-gray-900 dark:text-white"},ee={class:"text-xs text-gray-500 dark:text-gray-400"},ae={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},se={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},re={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},oe=["onClick"],ne={class:"flex-1 min-w-0"},le={class:"font-semibold text-gray-900 dark:text-white truncate flex items-center gap-1"},de={class:"text-sm text-gray-500 dark:text-gray-400"},ie={class:"text-right shrink-0"},ce={class:"text-lg font-bold text-gray-900 dark:text-white"},ue={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},ge={class:"p-5 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between"},me={class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider flex items-center gap-2"},xe={class:"text-sm text-gray-500 dark:text-gray-400"},ye={key:0,class:"p-8 text-center text-gray-500 dark:text-gray-400"},he={key:1,class:"divide-y divide-gray-100 dark:divide-gray-700 max-h-96 overflow-y-auto"},pe={class:"w-14 text-center shrink-0"},_e={class:"text-sm font-semibold text-gray-900 dark:text-white"},ve={class:"flex-1 min-w-0"},be={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},ke={class:"text-xs text-gray-500 dark:text-gray-400"},fe={class:"text-lg font-bold text-gray-900 dark:text-white shrink-0"},Ce=lt({__name:"StatistiquesPage",setup(we){const H=gt(),v=m(!0),b=m({total:0,count:0,avgTicket:0}),L=m({total:0,count:0,avgTicket:0}),K=m({total:0,count:0,avgTicket:0}),$=m(0),j=m(0),V=m([]),k=m([]),C=m([]),f=m([]),A=M(()=>$.value===0?0:(b.value.total-$.value)/$.value*100),I=M(()=>j.value===0?0:(L.value.total-j.value)/j.value*100),Q=M(()=>Math.max(...V.value.map(s=>s.total),1)),X=M(()=>Math.max(...k.value.map(s=>s.count),1)),N=async()=>{v.value=!0;try{const s=new Date,a=s.toISOString().split("T")[0],e=new Date(s.getTime()-1440*60*1e3).toISOString().split("T")[0],l=new Date(s.getTime()-10080*60*1e3).toISOString().split("T")[0],u=new Date(s.getTime()-336*60*60*1e3).toISOString().split("T")[0],p=new Date(s.getTime()-720*60*60*1e3).toISOString().split("T")[0],{data:_}=await x.from("sales").select("total").gte("created_at",`${a}T00:00:00`).eq("status","completed"),g=_||[];b.value={total:g.reduce((d,i)=>d+i.total,0),count:g.length,avgTicket:g.length>0?g.reduce((d,i)=>d+i.total,0)/g.length:0};const{data:w}=await x.from("sales").select("total").gte("created_at",`${e}T00:00:00`).lt("created_at",`${a}T00:00:00`).eq("status","completed");$.value=(w||[]).reduce((d,i)=>d+i.total,0);const{data:B}=await x.from("sales").select("total").gte("created_at",`${l}T00:00:00`).eq("status","completed"),T=B||[];L.value={total:T.reduce((d,i)=>d+i.total,0),count:T.length,avgTicket:T.length>0?T.reduce((d,i)=>d+i.total,0)/T.length:0};const{data:ot}=await x.from("sales").select("total").gte("created_at",`${u}T00:00:00`).lt("created_at",`${l}T00:00:00`).eq("status","completed");j.value=(ot||[]).reduce((d,i)=>d+i.total,0);const{data:nt}=await x.from("sales").select("total").gte("created_at",`${p}T00:00:00`).eq("status","completed"),S=nt||[];K.value={total:S.reduce((d,i)=>d+i.total,0),count:S.length,avgTicket:S.length>0?S.reduce((d,i)=>d+i.total,0)/S.length:0},await Y(),await Z(),await tt(),await et()}catch(s){console.error("Erreur chargement stats:",s)}finally{v.value=!1}},Y=async()=>{const s=[],a=new Date;for(let e=6;e>=0;e--){const l=new Date(a.getTime()-e*24*60*60*1e3),u=l.toISOString().split("T")[0],p=new Date(l.getTime()+1440*60*1e3).toISOString().split("T")[0],{data:_}=await x.from("sales").select("total").gte("created_at",`${u}T00:00:00`).lt("created_at",`${p}T00:00:00`).eq("status","completed"),g=_||[];s.push({date:u,total:g.reduce((w,B)=>w+B.total,0),count:g.length})}V.value=s},Z=async()=>{const{data:s}=await x.from("sale_items").select("product_name, quantity, subtotal_ttc");if(!s){k.value=[];return}const a=new Map;for(const e of s){const l=a.get(e.product_name);l?(l.count+=e.quantity,l.revenue+=e.subtotal_ttc):a.set(e.product_name,{name:e.product_name,count:e.quantity,revenue:e.subtotal_ttc})}k.value=Array.from(a.values()).sort((e,l)=>l.count-e.count).slice(0,5)},tt=async()=>{const{data:s}=await x.from("vendors").select("id, first_name, last_name, initials, color").eq("is_active",!0);if(!s){C.value=[];return}const a=new Date,e=new Date(a.getTime()-720*60*60*1e3).toISOString().split("T")[0],l=[];for(const u of s){const{data:p}=await x.from("sales").select("total").eq("vendor_id",u.id).gte("created_at",`${e}T00:00:00`).eq("status","completed"),_=p||[];l.push({id:u.id,name:`${u.first_name} ${u.last_name}`,initials:u.initials??"",color:u.color??"#6B7280",total:_.reduce((g,w)=>g+w.total,0),count:_.length})}C.value=l.sort((u,p)=>p.total-u.total)},et=async()=>{const s=new Date().toISOString().split("T")[0],{data:a}=await x.from("sales").select(`
      id,
      ticket_number,
      total,
      created_at,
      client:clients(first_name, last_name),
      vendor:vendors(first_name, last_name),
      items:sale_items(id)
    `).gte("created_at",`${s}T00:00:00`).eq("status","completed").order("created_at",{ascending:!1});if(!a){f.value=[];return}f.value=a.map(e=>({id:e.id,ticket_number:e.ticket_number,total:e.total,created_at:e.created_at,client_name:e.client?`${e.client.first_name} ${e.client.last_name}`:null,vendor_name:e.vendor?`${e.vendor.first_name} ${e.vendor.last_name}`:"Inconnu",items_count:e.items?.length||0}))},h=s=>s.toFixed(2),at=s=>new Date(s).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric"}),st=s=>new Date(s).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),rt=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"});return dt(N),(s,a)=>(o(),n("main",pt,[t("div",_t,[t("div",vt,[a[1]||(a[1]=t("div",null,[t("h1",{class:"text-xl lg:text-2xl font-bold text-gray-900 dark:text-white"},"Statistiques"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"Vue d'ensemble de l'activité")],-1)),t("button",{onClick:N,disabled:v.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 dark:bg-emerald-600 dark:hover:bg-emerald-500 text-white rounded-xl hover:bg-gray-800 transition-colors disabled:opacity-50"},[y(c(U),{class:O(["w-4 h-4",v.value&&"animate-spin"])},null,8,["class"]),a[0]||(a[0]=t("span",null,"Actualiser",-1))],8,bt)]),v.value?(o(),n("div",kt,[y(c(U),{class:"w-8 h-8 text-gray-400 animate-spin"})])):(o(),n(D,{key:1},[t("div",ft,[t("div",wt,[t("div",Tt,[t("div",St,[y(c(it),{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})]),A.value!==0?(o(),n("div",{key:0,class:O(["inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",A.value>0?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"])},[(o(),P(J(A.value>0?c(W):c(z)),{class:"w-3 h-3"})),q(" "+r(Math.abs(A.value).toFixed(0))+"% ",1)],2)):R("",!0)]),t("p",Dt,r(h(b.value.total))+"€",1),a[2]||(a[2]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"CA aujourd'hui",-1))]),t("div",qt,[t("div",$t,[t("div",jt,[y(c(ct),{class:"w-5 h-5 text-blue-600 dark:text-blue-400"})]),I.value!==0?(o(),n("div",{key:0,class:O(["inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",I.value>0?"bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300":"bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-300"])},[(o(),P(J(I.value>0?c(W):c(z)),{class:"w-3 h-3"})),q(" "+r(Math.abs(I.value).toFixed(0))+"% ",1)],2)):R("",!0)]),t("p",Ct,r(h(L.value.total))+"€",1),a[3]||(a[3]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"CA cette semaine",-1))]),t("div",At,[t("div",It,[t("div",Mt,[y(c(mt),{class:"w-5 h-5 text-purple-600 dark:text-purple-400"})])]),t("p",Ot,r(b.value.count),1),a[4]||(a[4]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"Ventes aujourd'hui",-1))]),t("div",Ft,[t("div",Lt,[t("div",Vt,[y(c(ut),{class:"w-5 h-5 text-amber-600 dark:text-amber-400"})])]),t("p",Bt,r(h(b.value.avgTicket))+"€",1),a[5]||(a[5]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"Panier moyen",-1))])]),t("div",Rt,[t("div",Et,[a[6]||(a[6]=t("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider mb-4"}," Chiffre d'affaires (7 derniers jours) ",-1)),t("div",Nt,[(o(!0),n(D,null,F(V.value,e=>(o(),n("div",{key:e.date,class:"flex items-center gap-3"},[t("span",Pt,r(at(e.date)),1),t("div",Jt,[t("div",{class:"h-full bg-gradient-to-r from-emerald-500 to-emerald-400 dark:from-emerald-600 dark:to-emerald-500 rounded-lg transition-all duration-500",style:E({width:`${e.total/Q.value*100}%`})},null,4),e.total>0?(o(),n("span",Ut,r(h(e.total))+"€ ",1)):R("",!0)]),t("span",Wt,r(e.count)+" v.",1)]))),128))])]),t("div",zt,[t("h3",Gt,[y(c(xt),{class:"w-4 h-4 text-amber-500 dark:text-amber-400"}),a[7]||(a[7]=q(" Top 5 Services ",-1))]),k.value.length===0?(o(),n("div",Ht," Aucune donnée ")):(o(),n("div",Kt,[(o(!0),n(D,null,F(k.value,(e,l)=>(o(),n("div",{key:e.name,class:"flex items-center gap-3"},[t("span",{class:O(["w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold",l===0?"bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300":"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"])},r(l+1),3),t("div",Qt,[t("p",Xt,r(e.name),1),t("div",Yt,[t("div",{class:"h-full bg-gradient-to-r from-purple-500 to-purple-400 dark:from-purple-600 dark:to-purple-500 rounded-full",style:E({width:`${e.count/X.value*100}%`})},null,4)])]),t("div",Zt,[t("p",te,r(e.count),1),t("p",ee,r(h(e.revenue))+"€",1)])]))),128))]))])]),t("div",ae,[a[8]||(a[8]=t("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider mb-4"}," Performance vendeurs (30 derniers jours) ",-1)),C.value.length===0?(o(),n("div",se," Aucune donnée ")):(o(),n("div",re,[(o(!0),n(D,null,F(C.value,e=>(o(),n("button",{key:e.id,onClick:l=>c(H).push({name:"stats-employe",query:{vendorId:e.id}}),class:"flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors text-left group cursor-pointer"},[t("div",{style:E({backgroundColor:e.color}),class:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold shrink-0"},r(e.initials),5),t("div",ne,[t("p",le,[q(r(e.name)+" ",1),y(c(ht),{class:"w-3.5 h-3.5 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]),t("p",de,r(e.count)+" ventes",1)]),t("div",ie,[t("p",ce,r(h(e.total))+"€",1)])],8,oe))),128))]))]),t("div",ue,[t("div",ge,[t("h3",me,[y(c(yt),{class:"w-4 h-4 dark:text-gray-400"}),q(" Journal des ventes — "+r(rt(new Date().toISOString())),1)]),t("span",xe,r(f.value.length)+" ventes",1)]),f.value.length===0?(o(),n("div",ye," Aucune vente aujourd'hui ")):(o(),n("div",he,[(o(!0),n(D,null,F(f.value,e=>(o(),n("div",{key:e.id,class:"px-5 py-3 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"},[t("div",pe,[t("p",_e,r(st(e.created_at)),1)]),t("div",ve,[t("p",be,r(e.client_name||"Client anonyme"),1),t("p",ke,r(e.ticket_number)+" · "+r(e.items_count)+" article(s) · "+r(e.vendor_name),1)]),t("p",fe,r(h(e.total))+"€",1)]))),128))]))])],64))])]))}});export{Ce as default};
