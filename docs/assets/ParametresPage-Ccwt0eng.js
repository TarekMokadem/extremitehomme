import{c as G,a as w,r as T,s as H,d as $,D as C,y as J,b as k,e as t,h as g,k as h,f as a,S as K,n as Q,F as W,j as R,t as X,v as u,x as p,o as E}from"./index-DodYGpJ8.js";import{a as j,I as A,b as B,S as L,P as Y}from"./formatInputs-eH51u1C3.js";import{R as D}from"./refresh-cw-C5BCTzhv.js";import{F as Z}from"./file-text-C3Ju1Lll.js";const _=G("building-2",[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]]),S={salon_info:{name:"Extrémités Homme",address:"",phone:"",siret:""},tva_rates:{normal:.2,reduced:.1,super_reduced:.055},ticket_header:{line1:"Extrémités Homme",line2:"",line3:""},ticket_footer:{line1:"Merci de votre visite !",line2:""},loyalty:{points_per_euro:1,euros_per_point:.01,enabled:!1}},U=T({}),M=T(!1),P=T(!1);function ee(){const F=async()=>{M.value=!0;try{const{data:n,error:r}=await H.from("settings").select("key, value");if(r)throw r;const l={};(n||[]).forEach(o=>{l[o.key]=o.value}),Object.keys(S).forEach(o=>{l[o]==null&&(l[o]=S[o])}),U.value=l}catch(n){console.error("Erreur chargement paramètres:",n),Object.keys(S).forEach(r=>{U.value[r]=S[r]})}finally{M.value=!1}},V=async(n,r)=>{P.value=!0;try{const{error:l}=await H.from("settings").upsert({key:n,value:r,updated_at:new Date().toISOString()},{onConflict:"key"});if(l)throw l;U.value[n]=r}catch(l){throw console.error("Erreur sauvegarde paramètre:",l),l}finally{P.value=!1}},i=n=>{const r=U.value[n];return r??S[n]??{}},y=w(()=>i("salon_info")),b=w(()=>i("tva_rates")),c=w(()=>i("ticket_header")),I=w(()=>i("ticket_footer")),v=w(()=>i("loyalty"));return{loadSettings:F,saveSetting:V,get:i,salonInfo:y,tvaRates:b,ticketHeader:c,ticketFooter:I,loyaltyConfig:v,isLoading:M,isSaving:P}}const te={class:"flex-1 p-4 lg:p-6 overflow-auto bg-gray-50"},re={class:"max-w-2xl mx-auto space-y-6"},se={class:"flex items-center justify-between"},le={class:"text-xl lg:text-2xl font-bold text-gray-900 flex items-center gap-2"},ae=["disabled"],oe={key:0,class:"flex justify-center py-12"},ne={key:0,class:"text-sm text-red-600 bg-red-50 px-4 py-2 rounded-xl"},ie={key:1,class:"text-sm text-emerald-600 bg-emerald-50 px-4 py-2 rounded-xl"},de={class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"},ue={class:"px-5 py-4 border-b border-gray-200 flex items-center gap-2"},pe={class:"p-5 space-y-4"},me=["value","maxlength"],ge=["value","maxlength"],xe=["disabled"],fe={class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"},ye={class:"px-5 py-4 border-b border-gray-200 flex items-center gap-2"},be={class:"p-5 space-y-4"},ce=["disabled"],ve={class:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"},we={class:"px-5 py-4 border-b border-gray-200 flex items-center gap-2"},ke={class:"p-5 space-y-4"},he={class:"pt-2 border-t border-gray-100"},Ee=["disabled"],Ce=$({__name:"ParametresPage",setup(F){const{loadSettings:V,saveSetting:i,salonInfo:y,tvaRates:b,ticketHeader:c,ticketFooter:I,isLoading:v,isSaving:n}=ee(),r=C({name:"",address:"",phone:"",siret:""}),l=C({normal:.2,reduced:.1,super_reduced:.055}),o=C({line1:"",line2:"",line3:""}),x=C({line1:"",line2:""}),d=T(!1),f=T("");function N(){r.name=y.value.name,r.address=y.value.address,r.phone=j(y.value.phone||""),r.siret=B(y.value.siret||""),l.normal=b.value.normal,l.reduced=b.value.reduced,l.super_reduced=b.value.super_reduced,o.line1=c.value.line1,o.line2=c.value.line2??"",o.line3=c.value.line3??"",x.line1=I.value.line1,x.line2=I.value.line2??""}async function O(){f.value="",d.value=!1;try{await i("salon_info",{...r}),d.value=!0,setTimeout(()=>d.value=!1,2500)}catch(m){f.value=m instanceof Error?m.message:"Erreur lors de l'enregistrement"}}async function q(){f.value="",d.value=!1;try{await i("tva_rates",{...l}),d.value=!0,setTimeout(()=>d.value=!1,2500)}catch(m){f.value=m instanceof Error?m.message:"Erreur lors de l'enregistrement"}}async function z(){f.value="",d.value=!1;try{await i("ticket_header",{line1:o.line1,line2:o.line2,line3:o.line3}),await i("ticket_footer",{line1:x.line1,line2:x.line2}),d.value=!0,setTimeout(()=>d.value=!1,2500)}catch(m){f.value=m instanceof Error?m.message:"Erreur lors de l'enregistrement"}}return J(async()=>{await V(),N()}),(m,e)=>(E(),k("main",te,[t("div",re,[t("div",se,[t("div",null,[t("h1",le,[g(a(K),{class:"w-7 h-7 text-gray-600"}),e[13]||(e[13]=h(" Paramètres ",-1))]),e[14]||(e[14]=t("p",{class:"text-sm text-gray-500 mt-1"},"Informations du commerce et des tickets",-1))]),t("button",{onClick:e[0]||(e[0]=s=>{a(V)(),N()}),disabled:a(v),class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-colors disabled:opacity-50"},[g(a(D),{class:Q(["w-4 h-4",a(v)&&"animate-spin"])},null,8,["class"]),e[15]||(e[15]=h(" Actualiser ",-1))],8,ae)]),a(v)?(E(),k("div",oe,[g(a(D),{class:"w-8 h-8 text-gray-400 animate-spin"})])):(E(),k(W,{key:1},[f.value?(E(),k("p",ne,X(f.value),1)):R("",!0),d.value?(E(),k("p",ie," Paramètres enregistrés. ")):R("",!0),t("section",de,[t("div",ue,[g(a(_),{class:"w-5 h-5 text-gray-600"}),e[16]||(e[16]=t("h2",{class:"font-semibold text-gray-900"},"Informations du salon",-1))]),t("div",pe,[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nom du commerce",-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>r.name=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent",placeholder:"Extrémités Homme"},null,512),[[p,r.name]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Adresse",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>r.address=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent",placeholder:"123 rue Example"},null,512),[[p,r.address]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Téléphone",-1)),t("input",{value:r.phone,type:"tel",inputmode:"numeric",autocomplete:"tel",maxlength:a(A).phone,placeholder:"01 23 45 67 89",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent",onInput:e[3]||(e[3]=s=>r.phone=a(j)(s.target.value))},null,40,me)]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"SIRET",-1)),t("input",{value:r.siret,type:"text",inputmode:"numeric",maxlength:a(A).siret,placeholder:"123 456 789 00012",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent",onInput:e[4]||(e[4]=s=>r.siret=a(B)(s.target.value))},null,40,ge)]),t("button",{onClick:O,disabled:a(n),class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-xl hover:bg-gray-800 disabled:opacity-50"},[g(a(L),{class:"w-4 h-4"}),e[21]||(e[21]=h(" Enregistrer ",-1))],8,xe)])]),t("section",fe,[t("div",ye,[g(a(Y),{class:"w-5 h-5 text-gray-600"}),e[22]||(e[22]=t("h2",{class:"font-semibold text-gray-900"},"Taux de TVA",-1))]),t("div",be,[e[30]||(e[30]=t("p",{class:"text-sm text-gray-500"}," Ces taux sont utilisés pour l’affichage et les calculs. Le taux normal s’applique par défaut aux services. ",-1)),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Taux normal (%)",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.normal=s),type:"number",min:"0",max:"1",step:"0.01",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent"},null,512),[[p,l.normal,void 0,{number:!0}]]),e[24]||(e[24]=t("p",{class:"text-xs text-gray-500 mt-1"},"Ex. 0,20 pour 20 %",-1))]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Taux réduit (%)",-1)),u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.reduced=s),type:"number",min:"0",max:"1",step:"0.01",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent"},null,512),[[p,l.reduced,void 0,{number:!0}]]),e[26]||(e[26]=t("p",{class:"text-xs text-gray-500 mt-1"},"Ex. 0,10 pour 10 %",-1))]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Taux super réduit (%)",-1)),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.super_reduced=s),type:"number",min:"0",max:"1",step:"0.01",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent"},null,512),[[p,l.super_reduced,void 0,{number:!0}]]),e[28]||(e[28]=t("p",{class:"text-xs text-gray-500 mt-1"},"Ex. 0,055 pour 5,5 %",-1))]),t("button",{onClick:q,disabled:a(n),class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-xl hover:bg-gray-800 disabled:opacity-50"},[g(a(L),{class:"w-4 h-4"}),e[29]||(e[29]=h(" Enregistrer ",-1))],8,ce)])]),t("section",ve,[t("div",we,[g(a(Z),{class:"w-5 h-5 text-gray-600"}),e[31]||(e[31]=t("h2",{class:"font-semibold text-gray-900"},"Ticket — En-tête et pied de page",-1))]),t("div",ke,[e[38]||(e[38]=t("p",{class:"text-sm text-gray-500"}," Texte affiché en haut et en bas du ticket (impression ou aperçu). ",-1)),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"En-tête — Ligne 1",-1)),u(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.line1=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent",placeholder:"Nom du salon"},null,512),[[p,o.line1]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"En-tête — Ligne 2",-1)),u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.line2=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent",placeholder:"Adresse ou téléphone"},null,512),[[p,o.line2]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"En-tête — Ligne 3",-1)),u(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>o.line3=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent",placeholder:"SIRET ou autre"},null,512),[[p,o.line3]])]),t("div",he,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Pied de page — Ligne 1",-1)),u(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>x.line1=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent",placeholder:"Merci de votre visite !"},null,512),[[p,x.line1]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Pied de page — Ligne 2",-1)),u(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>x.line2=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-transparent",placeholder:""},null,512),[[p,x.line2]])]),t("button",{onClick:z,disabled:a(n),class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-xl hover:bg-gray-800 disabled:opacity-50"},[g(a(L),{class:"w-4 h-4"}),e[37]||(e[37]=h(" Enregistrer ",-1))],8,Ee)])])],64))])]))}});export{Ce as default};
