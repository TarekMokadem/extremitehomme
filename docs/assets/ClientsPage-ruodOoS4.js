import{c as T,d as Q,r as x,a as X,y as G,b as i,e,h as n,t as r,n as S,f as u,v as c,x as p,F as E,g as U,w as q,T as M,s as k,j as v,k as b,H as J,z as K,o as d}from"./index-DodYGpJ8.js";import{R as L}from"./refresh-cw-C5BCTzhv.js";import{S as O}from"./search-By6t2NqO.js";import{U as W,M as Y,a as Z}from"./user-plus-Be-_qFL1.js";import{X as F}from"./x-21iBCkkO.js";import{E as ee}from"./euro-_aVnEfKE.js";import{S as te}from"./shopping-bag-Cf2Hlekb.js";import{C as se}from"./calendar-RNeGf9Td.js";import{S as le}from"./square-pen-DW1r5ojL.js";import{T as P}from"./trash-2-BKEdKMe_.js";const ae=T("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const N=T("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);const oe=T("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),re={class:"flex-1 flex overflow-hidden bg-gray-50"},ne={class:"p-4 lg:p-6 border-b border-gray-200 bg-white"},ie={class:"flex items-center justify-between mb-4"},de={class:"text-sm text-gray-500"},ue=["disabled"],ce={class:"relative"},pe={class:"flex-1 overflow-y-auto"},xe={key:0,class:"p-8 text-center"},ve={key:1,class:"p-8 text-center"},ye={key:2,class:"divide-y divide-gray-100"},ge=["onClick"],me={class:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},fe={class:"text-lg font-semibold text-gray-600"},be={class:"flex-1 min-w-0"},he={class:"font-semibold text-gray-900 truncate"},_e={class:"text-sm text-gray-500 truncate"},we={class:"hidden sm:block text-right flex-shrink-0"},ke={class:"text-sm font-medium text-gray-900"},Ce={class:"text-xs text-gray-500"},Ve={key:0,class:"w-full lg:w-[450px] lg:max-h-[65vh] flex-shrink-0 bg-white border-l border-gray-200 flex flex-col fixed inset-0 lg:top-[10%] lg:right-4 lg:bottom-auto lg:left-auto z-20 shadow-xl rounded-xl overflow-hidden"},je={class:"p-4 lg:p-6 border-b border-gray-200 flex items-start justify-between"},Se={class:"flex items-center gap-4"},Ee={class:"w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center"},Ue={class:"text-2xl font-bold text-blue-600"},qe={class:"text-xl font-bold text-gray-900"},Me={class:"text-sm text-gray-500"},Le={class:"flex-1 overflow-y-auto p-4 lg:p-6 space-y-6"},Te={class:"grid grid-cols-3 gap-3"},De={class:"bg-gray-50 rounded-xl p-3 text-center"},ze={class:"text-lg font-bold text-gray-900 mt-1"},Ae={class:"bg-gray-50 rounded-xl p-3 text-center"},Fe={class:"text-lg font-bold text-gray-900 mt-1"},Pe={class:"bg-gray-50 rounded-xl p-3 text-center"},Ne={class:"text-lg font-bold text-gray-900 mt-1"},$e={class:"space-y-3"},Re={class:"space-y-2"},Be={class:"flex items-center gap-3 text-sm"},He={class:"text-gray-900"},Ie={key:0,class:"flex items-center gap-3 text-sm"},Qe={class:"text-gray-700"},Xe={key:1,class:"flex items-center gap-3 text-sm"},Ge={class:"text-gray-700"},Je={key:2,class:"flex items-start gap-3 text-sm"},Ke={class:"text-gray-700"},Oe={key:3,class:"flex items-center gap-3 text-sm"},We={class:"text-gray-700"},Ye={key:0,class:"mt-3 p-3 bg-yellow-50 rounded-lg text-sm text-yellow-800"},Ze={class:"space-y-3"},et={class:"text-sm font-semibold text-gray-900 uppercase tracking-wider flex items-center gap-2"},tt={key:0,class:"py-4 text-center"},st={key:1,class:"py-4 text-center text-gray-500 text-sm"},lt={key:2,class:"space-y-2"},at={class:"flex items-center justify-between mb-2"},ot={class:"text-xs text-gray-500"},rt={class:"font-semibold text-gray-900"},nt={class:"text-xs text-gray-600"},it={key:0},dt={class:"p-4 border-t border-gray-200 flex gap-3"},ut={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50"},ct={class:"bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto"},pt={class:"p-6 border-b border-gray-200 flex items-center justify-between"},xt={class:"grid grid-cols-2 gap-4"},vt={class:"grid grid-cols-2 gap-4"},yt={class:"grid grid-cols-2 gap-4"},gt={class:"flex gap-3 pt-4"},mt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50"},ft={class:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center"},bt={class:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4"},ht={class:"text-sm text-gray-500 mb-6"},_t={class:"flex gap-3"},Tt=Q({__name:"ClientsPage",setup(wt){const y=x([]),g=x(!0),h=x(""),o=x(null),m=x([]),C=x(!1),f=x(!1),_=x(!1),a=x({id:"",first_name:"",last_name:"",phone:"",phone2:"",email:"",address:"",city:"",postal_code:"",birth_date:"",notes:""}),w=async()=>{g.value=!0;try{const{data:l,error:t}=await k.from("clients").select("*").order("last_name");if(t)throw t;y.value=l||[]}catch(l){console.error("Erreur chargement clients:",l),y.value=[]}finally{g.value=!1}},$=async l=>{C.value=!0;try{const{data:t,error:s}=await k.from("sales").select(`
        *,
        items:sale_items(product_name, quantity, subtotal_ttc),
        vendor:vendors(first_name, last_name)
      `).eq("client_id",l).order("created_at",{ascending:!1}).limit(20);if(s)throw s;m.value=t||[]}catch(t){console.error("Erreur chargement ventes client:",t),m.value=[]}finally{C.value=!1}},D=X(()=>{if(!h.value.trim())return y.value;const l=h.value.toLowerCase();return y.value.filter(t=>t.first_name.toLowerCase().includes(l)||t.last_name.toLowerCase().includes(l)||t.phone.includes(l)||t.email?.toLowerCase().includes(l))}),R=l=>{o.value=l,$(l.id)},z=()=>{o.value=null,m.value=[]},B=l=>{a.value={id:l.id,first_name:l.first_name,last_name:l.last_name,phone:l.phone,phone2:l.phone2||"",email:l.email||"",address:l.address||"",city:l.city||"",postal_code:l.postal_code||"",birth_date:l.birth_date||"",notes:l.notes||""},f.value=!0},H=async()=>{if(a.value.id)try{const{error:l}=await k.from("clients").update({first_name:a.value.first_name,last_name:a.value.last_name,phone:a.value.phone,phone2:a.value.phone2||null,email:a.value.email||null,address:a.value.address||null,city:a.value.city||null,postal_code:a.value.postal_code||null,birth_date:a.value.birth_date||null,notes:a.value.notes||null}).eq("id",a.value.id);if(l)throw l;if(await w(),o.value?.id===a.value.id){const t=y.value.find(s=>s.id===a.value.id);t&&(o.value=t)}f.value=!1,alert("Client mis à jour !")}catch(l){console.error("Erreur mise à jour:",l),alert("Erreur lors de la mise à jour")}},I=async()=>{if(o.value)try{const{error:l}=await k.from("clients").delete().eq("id",o.value.id);if(l)throw l;z(),await w(),_.value=!1,alert("Client supprimé !")}catch(l){console.error("Erreur suppression:",l),alert("Erreur lors de la suppression")}},V=l=>l?new Date(l).toLocaleDateString("fr-FR"):"-";return G(w),(l,t)=>(d(),i("main",re,[e("div",{class:S(["flex-1 flex flex-col min-w-0 bg-white overflow-hidden transition-all duration-200",o.value?"lg:mr-[450px]":""])},[e("div",ne,[e("div",ie,[e("div",null,[t[16]||(t[16]=e("h1",{class:"text-xl lg:text-2xl font-bold text-gray-900"},"Clients",-1)),e("p",de,r(y.value.length)+" clients enregistrés",1)]),e("button",{onClick:w,disabled:g.value,class:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"},[n(u(L),{class:S(["w-5 h-5",g.value&&"animate-spin"])},null,8,["class"])],8,ue)]),e("div",ce,[n(u(O),{class:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),type:"text",placeholder:"Rechercher par nom, téléphone, email...",class:"w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-300 rounded-xl text-sm focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"},null,512),[[p,h.value]])])]),e("div",pe,[g.value?(d(),i("div",xe,[n(u(L),{class:"w-8 h-8 text-gray-400 animate-spin mx-auto"})])):D.value.length===0?(d(),i("div",ve,[n(u(W),{class:"w-12 h-12 text-gray-300 mx-auto"}),t[17]||(t[17]=e("p",{class:"text-gray-500 mt-2"},"Aucun client trouvé",-1))])):(d(),i("div",ye,[(d(!0),i(E,null,U(D.value,s=>(d(),i("button",{key:s.id,onClick:j=>R(s),class:S(["w-full px-4 lg:px-6 py-4 flex items-center gap-4 text-left hover:bg-gray-50 transition-colors",o.value?.id===s.id&&"bg-blue-50 hover:bg-blue-50"])},[e("div",me,[e("span",fe,r(s.first_name[0])+r(s.last_name[0]),1)]),e("div",be,[e("p",he,r(s.first_name)+" "+r(s.last_name),1),e("p",_e,r(s.phone),1)]),e("div",we,[e("p",ke,r(s.total_spent?.toFixed(2)||"0.00")+"€",1),e("p",Ce,r(s.visit_count||0)+" visites",1)]),n(u(ae),{class:"w-5 h-5 text-gray-400 flex-shrink-0"})],10,ge))),128))]))])],2),n(M,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"translate-x-full opacity-0","enter-to-class":"translate-x-0 opacity-100","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"translate-x-0 opacity-100","leave-to-class":"translate-x-full opacity-0"},{default:q(()=>[o.value?(d(),i("div",Ve,[e("div",je,[e("div",Se,[e("div",Ee,[e("span",Ue,r(o.value.first_name[0])+r(o.value.last_name[0]),1)]),e("div",null,[e("h2",qe,r(o.value.first_name)+" "+r(o.value.last_name),1),e("p",Me,"Client depuis "+r(V(o.value.created_at)),1)])]),e("button",{onClick:z,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg"},[n(u(F),{class:"w-5 h-5"})])]),e("div",Le,[e("div",Te,[e("div",De,[n(u(ee),{class:"w-5 h-5 text-gray-400 mx-auto"}),e("p",ze,r(o.value.total_spent?.toFixed(0)||"0")+"€",1),t[18]||(t[18]=e("p",{class:"text-xs text-gray-500"},"Total dépensé",-1))]),e("div",Ae,[n(u(te),{class:"w-5 h-5 text-gray-400 mx-auto"}),e("p",Fe,r(o.value.visit_count||0),1),t[19]||(t[19]=e("p",{class:"text-xs text-gray-500"},"Visites",-1))]),e("div",Pe,[n(u(oe),{class:"w-5 h-5 text-gray-400 mx-auto"}),e("p",Ne,r(o.value.loyalty_points||0),1),t[20]||(t[20]=e("p",{class:"text-xs text-gray-500"},"Points",-1))])]),e("div",$e,[t[22]||(t[22]=e("h3",{class:"text-sm font-semibold text-gray-900 uppercase tracking-wider"},"Coordonnées",-1)),e("div",Re,[e("div",Be,[n(u(N),{class:"w-4 h-4 text-gray-400"}),e("span",He,r(o.value.phone),1)]),o.value.phone2?(d(),i("div",Ie,[n(u(N),{class:"w-4 h-4 text-gray-400"}),e("span",Qe,r(o.value.phone2),1)])):v("",!0),o.value.email?(d(),i("div",Xe,[n(u(Y),{class:"w-4 h-4 text-gray-400"}),e("span",Ge,r(o.value.email),1)])):v("",!0),o.value.address?(d(),i("div",Je,[n(u(Z),{class:"w-4 h-4 text-gray-400 mt-0.5"}),e("span",Ke,[b(r(o.value.address),1),t[21]||(t[21]=e("br",null,null,-1)),b(" "+r(o.value.postal_code)+" "+r(o.value.city),1)])])):v("",!0),o.value.birth_date?(d(),i("div",Oe,[n(u(se),{class:"w-4 h-4 text-gray-400"}),e("span",We,r(V(o.value.birth_date)),1)])):v("",!0)]),o.value.notes?(d(),i("div",Ye,r(o.value.notes),1)):v("",!0)]),e("div",Ze,[e("h3",et,[n(u(J),{class:"w-4 h-4"}),t[23]||(t[23]=b(" Historique des achats ",-1))]),C.value?(d(),i("div",tt,[n(u(L),{class:"w-5 h-5 text-gray-400 animate-spin mx-auto"})])):m.value.length===0?(d(),i("div",st," Aucun achat enregistré ")):(d(),i("div",lt,[(d(!0),i(E,null,U(m.value,s=>(d(),i("div",{key:s.id,class:"bg-gray-50 rounded-lg p-3"},[e("div",at,[e("span",ot,r(V(s.created_at)),1),e("span",rt,r(s.total.toFixed(2))+"€",1)]),e("div",nt,[(d(!0),i(E,null,U(s.items,(j,A)=>(d(),i("span",{key:A},[b(r(j.quantity)+"x "+r(j.product_name),1),A<s.items.length-1?(d(),i("span",it,", ")):v("",!0)]))),128))])]))),128))]))])]),e("div",dt,[e("button",{onClick:t[1]||(t[1]=s=>B(o.value)),class:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-900 text-white rounded-xl hover:bg-gray-800 transition-colors"},[n(u(le),{class:"w-4 h-4"}),t[24]||(t[24]=b(" Modifier ",-1))]),e("button",{onClick:t[2]||(t[2]=s=>_.value=!0),class:"px-4 py-2.5 text-red-600 hover:bg-red-50 rounded-xl transition-colors"},[n(u(P),{class:"w-4 h-4"})])])])):v("",!0)]),_:1}),n(M,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:q(()=>[f.value?(d(),i("div",ut,[e("div",ct,[e("div",pt,[t[25]||(t[25]=e("h3",{class:"text-lg font-bold text-gray-900"},"Modifier le client",-1)),e("button",{onClick:t[3]||(t[3]=s=>f.value=!1),class:"p-2 hover:bg-gray-100 rounded-lg"},[n(u(F),{class:"w-5 h-5 text-gray-500"})])]),e("form",{onSubmit:K(H,["prevent"]),class:"p-6 space-y-4"},[e("div",xt,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Prénom",-1)),c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.first_name=s),type:"text",required:"",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:border-gray-900"},null,512),[[p,a.value.first_name]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Nom",-1)),c(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.last_name=s),type:"text",required:"",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:border-gray-900"},null,512),[[p,a.value.last_name]])])]),e("div",vt,[e("div",null,[t[28]||(t[28]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Téléphone",-1)),c(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.value.phone=s),type:"tel",required:"",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:border-gray-900"},null,512),[[p,a.value.phone]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Tél. 2",-1)),c(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>a.value.phone2=s),type:"tel",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:border-gray-900"},null,512),[[p,a.value.phone2]])])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Email",-1)),c(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>a.value.email=s),type:"email",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:border-gray-900"},null,512),[[p,a.value.email]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Adresse",-1)),c(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>a.value.address=s),type:"text",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:border-gray-900"},null,512),[[p,a.value.address]])]),e("div",yt,[e("div",null,[t[32]||(t[32]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Ville",-1)),c(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>a.value.city=s),type:"text",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:border-gray-900"},null,512),[[p,a.value.city]])]),e("div",null,[t[33]||(t[33]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Code postal",-1)),c(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>a.value.postal_code=s),type:"text",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:border-gray-900"},null,512),[[p,a.value.postal_code]])])]),e("div",null,[t[34]||(t[34]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Date de naissance",-1)),c(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>a.value.birth_date=s),type:"date",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:border-gray-900"},null,512),[[p,a.value.birth_date]])]),e("div",null,[t[35]||(t[35]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Notes",-1)),c(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=s=>a.value.notes=s),rows:"2",class:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:border-gray-900 resize-none"},null,512),[[p,a.value.notes]])]),e("div",gt,[e("button",{type:"button",onClick:t[14]||(t[14]=s=>f.value=!1),class:"flex-1 px-4 py-2.5 border border-gray-300 rounded-xl hover:bg-gray-50"}," Annuler "),t[36]||(t[36]=e("button",{type:"submit",class:"flex-1 px-4 py-2.5 bg-gray-900 text-white rounded-xl hover:bg-gray-800"}," Enregistrer ",-1))])],32)])])):v("",!0)]),_:1}),n(M,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:q(()=>[_.value?(d(),i("div",mt,[e("div",ft,[e("div",bt,[n(u(P),{class:"w-6 h-6 text-red-600"})]),t[37]||(t[37]=e("h3",{class:"text-lg font-bold text-gray-900 mb-2"},"Supprimer ce client ?",-1)),e("p",ht,r(o.value?.first_name)+" "+r(o.value?.last_name)+" sera définitivement supprimé. ",1),e("div",_t,[e("button",{onClick:t[15]||(t[15]=s=>_.value=!1),class:"flex-1 px-4 py-2.5 border border-gray-300 rounded-xl hover:bg-gray-50"}," Annuler "),e("button",{onClick:I,class:"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-xl hover:bg-red-700"}," Supprimer ")])])])):v("",!0)]),_:1})]))}});export{Tt as default};
