import{c as xe,a as L,r as I,s as F,i as Te,d as ge,u as et,b as Ie,w as ve,e as d,f as e,t as y,g as a,F as Y,h as ae,n as K,j as S,E as ut,k as H,l as oe,m as de,o as Pe,p as mt,q as s,v as Me,T as qe,x as pt,P as Le,y as me,z as pe,A as tt,B as gt,H as yt,L as vt}from"./index-1XmwSQZZ.js";import{M as xt,u as Ue,U as We,a as bt}from"./useLoyalty-DwgMUDvm.js";import{P as ht,I as Ze,S as ft,f as Je,a as je}from"./formatInputs-BeJ4ADJj.js";import{P as kt,_ as _t}from"./_plugin-vue_export-helper-B4uamnPt.js";import{M as at}from"./minus-Ce0pRVYH.js";import{P as He}from"./plus-CzJP4T3u.js";import{T as rt}from"./trash-2-PlS4sgSp.js";import{B as wt,S as Ct,G as st,H as $t,W as ot}from"./wrench-CHA_UyML.js";import{C as Xe}from"./credit-card-Dej2oei4.js";import{C as St}from"./clock-He7OF5yD.js";import{X as Tt}from"./x-BsMOqToj.js";import{S as Pt}from"./shopping-bag-B8YaY3We.js";import{S as Ee}from"./search-DDaEsjhl.js";import{S as Et}from"./shopping-cart-BwM0CwmT.js";const It=xe("barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);const ze=xe("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const lt=xe("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);const Mt=xe("user-pen",[["path",{d:"M11.5 15H7a4 4 0 0 0-4 4v2",key:"15lzij"}],["path",{d:"M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1817ys"}],["circle",{cx:"10",cy:"7",r:"4",key:"e45bow"}]]);const qt=xe("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const Nt=xe("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);async function nt(q){const m=new TextEncoder().encode(q),E=await crypto.subtle.digest("SHA-256",m);return Array.from(new Uint8Array(E)).map(N=>N.toString(16).padStart(2,"0")).join("")}async function jt(q,m,E,B){const N=[q,m,E.toFixed(2),B??""].join("|");return nt(N)}async function Ye(q,m,E,B,N){const P=[q,m,E,B??"",N??""].join("|");return nt(P)}const X=I([]),fe=I("euro"),ne=I(0),ye=I(null),re=I([]),Ae=I([]),Fe=I(!1),ue=I(null),At=.2;function Ne(){const q=(t,o,w)=>{if(t.type!=="product")return 1/0;const V=X.value.filter(l=>l.product.id===t.id&&l.lineId!==o&&(l.stockCategory??"sale")===(w??"sale")).reduce((l,$)=>l+$.quantity,0),R=w==="technical"?t.stock_technical??0:t.stock??0;return Math.max(0,R-V)},m=(t,o=1,w,V="sale")=>{const R=q(t,void 0,V),l=t.type==="product"?Math.min(o,R):o;if(l<=0)return;const ee={lineId:`line-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,product:t,quantity:l,vendor_id:w?.id,vendor:w,stockCategory:V,price_ht:t.price_ht,tva_rate:t.tva_rate||At,subtotal_ht:0,tva:0,subtotal_ttc:0};E(ee),X.value.push(ee)},E=t=>{const o=t.fixedPriceTTC??t.product.price_ttc;t.subtotal_ttc=o*t.quantity;const w=1+t.tva_rate;t.subtotal_ht=t.subtotal_ttc/w,t.tva=t.subtotal_ttc-t.subtotal_ht,t.price_ht=t.subtotal_ht/t.quantity},B=t=>X.value.find(o=>o.lineId===t),N=(t,o)=>{const w=B(t);w&&(o==null||o<0?delete w.fixedPriceTTC:w.fixedPriceTTC=o,E(w))},P=(t,o)=>{const w=B(t);if(w)if(o<=0)O(t);else{const V=w.product.type==="product"?q(w.product,t)+w.quantity:o;w.quantity=Math.min(o,V),E(w)}},O=t=>{X.value=X.value.filter(o=>o.lineId!==t)},G=()=>{X.value=[],ne.value=0,ye.value=null,re.value=[]},v=L(()=>X.value.reduce((t,o)=>t+o.subtotal_ht,0)),r=L(()=>X.value.reduce((t,o)=>t+o.tva,0)),p=L(()=>v.value+r.value),h=L(()=>{if(ne.value<=0)return 0;if(fe.value==="euro")return Math.min(ne.value,p.value);{const t=Math.min(ne.value,100);return p.value*t/100}}),k=L(()=>ye.value!=null&&ye.value>=0?ye.value:Math.max(0,p.value-h.value)),j=L(()=>X.value.reduce((t,o)=>t+o.quantity,0)),A=L(()=>X.value.length===0),C=(t,o)=>{fe.value=t,ne.value=Math.max(0,o)},g=()=>{fe.value="euro",ne.value=0},T=t=>{ye.value=t},z=(t,o)=>{const w=re.value.find(V=>V.method===t);w?w.amount+=o:re.value.push({method:t,amount:o})},M=(t,o)=>{const w=re.value.find(V=>V.method===t);w?w.amount=o:re.value.push({method:t,amount:o})},x=t=>{re.value=re.value.filter(o=>o.method!==t)},b=()=>{re.value=[]},U=L(()=>re.value.reduce((t,o)=>t+o.amount,0)),J=L(()=>Math.max(0,k.value-U.value)),se=L(()=>Math.max(0,U.value-k.value)),W=L(()=>U.value>=k.value&&k.value>0),Z=()=>{const t=new Date,o=t.toISOString().split("T")[0].replace(/-/g,""),w=t.getTime().toString().slice(-4);return`T-${o}-${w}`};return{cartItems:X,discountType:fe,discountValue:ne,selectedPaymentMethods:re,recentSales:Ae,isProcessing:Fe,error:ue,subtotalHT:v,totalTVA:r,subtotalTTC:p,discountAmount:h,total:k,itemCount:j,isEmpty:A,totalPaid:U,remainingToPay:J,change:se,isPaymentComplete:W,addToCart:m,updateQuantity:P,removeFromCart:O,getMaxQuantityForItem:t=>t.product.type!=="product"?1/0:q(t.product,t.lineId,t.stockCategory)+t.quantity,setItemFixedPrice:N,clearCart:G,setDiscount:C,clearDiscount:g,setFixedTotal:T,fixedTotal:ye,addPayment:z,setPayment:M,removePayment:x,clearPayments:b,validateSale:async(t,o)=>{if(A.value)return ue.value="Le panier est vide",null;if(!o)return ue.value="Veuillez sélectionner ou créer un client avant de valider",null;if(!W.value)return ue.value="Le paiement n'est pas complet",null;if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t))return ue.value="Aucun vendeur sélectionné. Veuillez sélectionner un vendeur.",console.error("vendorId invalide:",t),null;Fe.value=!0,ue.value=null,console.log("Validation vente - vendorId:",t,"clientId:",o);try{if(Te()){const i=new Map;for(const Q of X.value)if(Q.product.type==="product"){const te=Q.stockCategory??"sale",le=`${Q.product.id}|${te}`,ce=i.get(le);ce?ce.qty+=Q.quantity:i.set(le,{qty:Q.quantity,name:Q.product.name,stockCat:te})}for(const[Q,{qty:te,name:le,stockCat:ce}]of i){const be=Q.split("|")[0],$e=ce==="technical"?"stock_technical":"stock",{data:he,error:Se}=await F.from("products").select(`${$e}`).eq("id",be).single();if(Se||!he)throw new Error(`Produit ${le} introuvable`);const Qe=he[$e]??0;if(Qe<te)throw new Error(`Stock insuffisant pour "${le}" (${ce==="technical"?"technique":"vente"}) : ${Qe} en stock, ${te} demandé`)}}let V;if(Te()){const{data:i}=await F.rpc("generate_ticket_number");V=i||Z()}const R=new Date().toISOString();let l=null;if(Te()){const{data:i}=await F.from("sales").select("hash").eq("status","completed").order("created_at",{ascending:!1}).limit(1).maybeSingle();l=i?.hash??null}const $=await jt(V,R,k.value,l),ee={ticket_number:V,vendor_id:t,client_id:o||null,subtotal_ht:v.value,total_tva:r.value,subtotal_ttc:p.value,discount_type:fe.value,discount_value:ne.value,discount_amount:h.value,total:k.value,status:"completed",hash:$,previous_hash:l,created_at:R},Ce=X.value.map(i=>({product_id:i.product.id,variant_id:i.variant?.id||null,vendor_id:i.vendor_id||t,product_name:i.product.name,price_ht:i.price_ht,tva_rate:i.tva_rate,quantity:i.quantity,subtotal_ht:i.subtotal_ht,tva:i.tva,subtotal_ttc:i.subtotal_ttc})),dt=re.value.map(i=>({method:i.method,amount:i.amount}));Te();const{data:ie,error:Ge}=await F.from("sales").insert(ee).select().single();if(Ge)throw Ge;const it=Ce.map(i=>({...i,sale_id:ie.id})),{error:Ke}=await F.from("sale_items").insert(it);if(Ke)throw Ke;const ct=dt.map(i=>({...i,sale_id:ie.id})),{error:Oe}=await F.from("payments").insert(ct);if(Oe)throw Oe;for(const i of X.value)if(i.product.type==="product"){const Q=i.stockCategory??"sale",te=Q==="technical"?"stock_technical":"stock",{data:le,error:ce}=await F.from("products").select(`${te}`).eq("id",i.product.id).single();if(ce||!le)throw new Error(`Produit ${i.product.name} introuvable`);const be=le[te]??0;if(be<i.quantity)throw new Error(`Stock insuffisant pour "${i.product.name}" (${Q==="technical"?"technique":"vente"}) : ${be} en stock, ${i.quantity} demandé`);const $e=be-i.quantity,{error:he}=await F.from("products").update({[te]:$e,updated_at:new Date().toISOString()}).eq("id",i.product.id);if(he)throw he;const{error:Se}=await F.from("stock_movements").insert({product_id:i.product.id,variant_id:i.variant?.id||null,type:"out",quantity:-i.quantity,reason:Q==="technical"?"Utilisation technique":"Vente",reference_id:ie.id,vendor_id:t,stock_type:Q});if(Se)throw Se}try{const{data:i}=await F.from("settings").select("value").eq("key","grand_total").maybeSingle(),te=(typeof i?.value=="number"?i.value:0)+k.value;await F.from("settings").upsert({key:"grand_total",value:te,updated_at:new Date().toISOString()},{onConflict:"key"})}catch(i){console.warn("NF525: erreur mise à jour GT —",i)}try{const{data:i}=await F.from("audit_logs").select("hash").order("created_at",{ascending:!1}).limit(1).maybeSingle(),Q=new Date().toISOString(),te=await Ye(Q,"sale_created","sales",ie.id,i?.hash??null);await F.from("audit_logs").insert({timestamp:Q,event_type:"sale_created",table_name:"sales",record_id:ie.id,old_data:null,new_data:{ticket_number:V,total:k.value},vendor_id:t,hash:te,previous_hash:i?.hash??null})}catch(i){console.warn("NF525: erreur audit log —",i)}if(o){const{data:i}=await F.from("clients").select("visit_count, total_spent, loyalty_points").eq("id",o).single();i&&await F.from("clients").update({visit_count:i.visit_count+1,total_spent:i.total_spent+k.value,last_visit_at:new Date().toISOString()}).eq("id",o)}return Ae.value.unshift(ie),G(),ie}catch(V){return console.error("Erreur validation vente:",V),ue.value=V.message||"Erreur lors de la validation",null}finally{Fe.value=!1}},loadRecentSales:async(t=10)=>{try{const{data:o,error:w}=await F.from("sales").select(`
          *,
          vendor:vendors(*),
          client:clients(*),
          items:sale_items(*),
          payments(*)
        `).order("created_at",{ascending:!1}).limit(t);if(w)throw w;return Ae.value=o||[],o}catch(o){return console.error("Erreur chargement ventes:",o),[]}},getSaleById:async t=>{try{const{data:o,error:w}=await F.from("sales").select(`
          *,
          vendor:vendors(*),
          client:clients(*),
          items:sale_items(*, product:products(*)),
          payments(*)
        `).eq("id",t).single();return w?null:o}catch{return null}},cancelSale:async(t,o)=>{try{const{error:w}=await F.from("sales").update({status:"cancelled",notes:o}).eq("id",t);if(w)throw w;try{const{data:V}=await F.from("audit_logs").select("hash").order("created_at",{ascending:!1}).limit(1).maybeSingle(),R=new Date().toISOString(),l=await Ye(R,"sale_cancelled","sales",t,V?.hash??null);await F.from("audit_logs").insert({timestamp:R,event_type:"sale_cancelled",table_name:"sales",record_id:t,old_data:{status:"completed"},new_data:{status:"cancelled",reason:o},vendor_id:null,hash:l,previous_hash:V?.hash??null})}catch(V){console.warn("NF525: erreur audit annulation —",V)}return!0}catch(w){return console.error("Erreur annulation vente:",w),!1}}}}const Ft=[{id:"1",first_name:"Jean",last_name:"Dupont",phone:"06 12 34 56 78",phone2:null,email:"jean.dupont@email.com",address:"123 Rue de la Paix",city:"Paris",postal_code:"75001",birth_date:"1985-03-15",notes:"Client fidèle",company:null,loyalty_points:150,total_spent:450,visit_count:15,last_visit_at:"2026-01-15",created_at:"",updated_at:""},{id:"2",first_name:"Marie",last_name:"Martin",phone:"06 98 76 54 32",phone2:"01 23 45 67 89",email:"marie.martin@email.com",address:"456 Avenue des Champs",city:"Lyon",postal_code:"69001",birth_date:"1990-07-22",notes:null,company:null,loyalty_points:75,total_spent:225,visit_count:8,last_visit_at:"2026-01-20",created_at:"",updated_at:""},{id:"3",first_name:"Pierre",last_name:"Bernard",phone:"07 11 22 33 44",phone2:null,email:null,address:null,city:null,postal_code:null,birth_date:null,notes:"Préfère les rendez-vous le samedi",company:null,loyalty_points:30,total_spent:90,visit_count:3,last_visit_at:"2026-01-10",created_at:"",updated_at:""}],Ve=I([]),Re=I(null),De=I(!1),Be=I(!1),ke=I(null);function we(){return{clients:Ve,selectedClient:Re,invoiceInCompanyName:De,isLoading:Be,error:ke,loadClients:async()=>{Be.value=!0,ke.value=null;try{const{data:r,error:p}=await F.from("clients").select("*").order("last_name");if(p)throw p;Ve.value=r||[]}catch(r){console.error("Erreur chargement clients:",r),ke.value=r.message,Ve.value=Ft}finally{Be.value=!1}},searchClients:async r=>{if(!r||r.length<2)return[];try{const{data:p,error:h}=await F.from("clients").select("*").or(`first_name.ilike.%${r}%,last_name.ilike.%${r}%,phone.ilike.%${r}%`).limit(10);if(h)throw h;return p||[]}catch(p){return console.error("Erreur recherche clients:",p),[]}},getClientById:async r=>{try{const{data:p,error:h}=await F.from("clients").select("*").eq("id",r).single();return h?null:p}catch{return null}},createClient:async r=>{console.log("createClient appelé avec:",r);try{console.log("Insertion dans Supabase...");const{data:p,error:h}=await F.from("clients").insert({first_name:r.first_name,last_name:r.last_name,phone:r.phone,phone2:r.phone2||null,email:r.email||null,address:r.address||null,city:r.city||null,postal_code:r.postal_code||null,birth_date:r.birth_date||null,notes:r.notes||null,company:r.company??null}).select().single();if(h)throw console.error("Erreur Supabase:",h),h;return console.log("Client créé avec succès:",p),p}catch(p){return console.error("Erreur création client:",p),ke.value=p.message,null}},updateClient:async(r,p)=>{console.log("updateClient appelé avec:",r,p);try{const{data:h,error:k}=await F.from("clients").update(p).eq("id",r).select().single();if(k)throw k;return console.log("Client mis à jour:",h),h}catch(h){return console.error("Erreur mise à jour client:",h),ke.value=h.message,null}},selectClient:r=>{Re.value=r},setInvoiceInCompanyName:r=>{De.value=r},clearSelection:()=>{Re.value=null,De.value=!1},updateClientAfterSale:async(r,p)=>{try{const{data:h}=await F.from("clients").select("visit_count, total_spent").eq("id",r).single();h&&await F.from("clients").update({visit_count:h.visit_count+1,total_spent:h.total_spent+p,last_visit_at:new Date().toISOString()}).eq("id",r)}catch(h){console.error("Erreur mise à jour client après vente:",h)}}}}const Vt={class:"card h-full flex flex-col overflow-hidden"},Rt={class:"p-4 md:p-5 border-b border-gray-200 bg-gray-50 dark:bg-gray-800 dark:border-gray-700"},Dt={class:"flex items-center justify-between"},Bt={class:"text-xs md:text-sm font-semibold text-gray-900 dark:text-gray-100"},Lt={class:"flex-1 overflow-y-auto p-4 md:p-5 space-y-2 md:space-y-3 min-h-0"},zt={class:"flex items-start justify-between gap-2 md:gap-3 mb-2 md:mb-3"},Ut={class:"flex-1 min-w-0"},Ht={class:"font-medium text-gray-900 dark:text-gray-100 line-clamp-2 text-xs md:text-sm leading-snug"},Gt={class:"flex items-center gap-1.5 mt-0.5"},Kt={key:0,class:"inline-flex px-1.5 py-0.5 rounded text-[9px] font-semibold bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300"},Ot={key:1,class:"text-[10px] text-gray-500 dark:text-gray-400"},Qt={class:"font-bold text-gray-900 dark:text-gray-100 whitespace-nowrap text-sm md:text-base tabular-nums"},Wt={class:"flex items-center gap-2 mb-2"},Zt=["value","onInput"],Jt={class:"flex items-center justify-between"},Xt={class:"flex items-center gap-2"},Yt=["onClick"],ea={class:"w-7 md:w-9 text-center text-xs md:text-sm font-semibold tabular-nums text-gray-900 dark:text-gray-100"},ta=["onClick","disabled"],aa=["onClick"],ra={key:1,class:"h-full flex items-center justify-center py-8"},sa={class:"px-4 py-3 md:px-5 md:py-4 border-t border-gray-100 dark:border-gray-700"},oa={class:"flex flex-col gap-2 md:gap-3"},la={class:"flex items-center justify-between gap-2"},na={class:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-full p-0.5 shadow-inner border border-gray-200 dark:border-gray-600"},da={class:"flex items-center gap-2"},ia=["value","max"],ca={class:"text-xs md:text-sm font-medium text-gray-500 dark:text-gray-400 min-w-[24px] md:min-w-[32px] text-center"},ua={class:"px-4 py-3 md:px-5 md:py-4 border-t border-gray-100 dark:border-gray-700"},ma={class:"flex flex-col gap-2"},pa={class:"flex items-center gap-2"},ga=["value"],ya={class:"px-4 py-3 md:px-5 md:py-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"},va={class:"grid grid-cols-3 md:grid-cols-2 gap-1.5 md:gap-2"},xa=["onClick"],ba={class:"font-medium truncate"},ha={class:"p-4 md:p-5 border-t-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},fa={class:"space-y-2 md:space-y-2.5 mb-3 md:mb-4"},ka={class:"flex justify-between text-xs md:text-sm"},_a={class:"text-gray-700 dark:text-gray-300 tabular-nums"},wa={class:"flex justify-between text-xs md:text-sm"},Ca={class:"text-gray-700 dark:text-gray-300 tabular-nums"},$a={class:"flex justify-between text-xs md:text-sm font-medium"},Sa={class:"text-gray-900 dark:text-gray-100 tabular-nums"},Ta={key:0,class:"flex justify-between text-xs md:text-sm"},Pa={class:"text-gray-600 dark:text-gray-400"},Ea={class:"text-[10px] md:text-xs"},Ia={class:"text-red-600 dark:text-red-400 font-medium tabular-nums"},Ma={class:"flex justify-between text-xl md:text-2xl font-bold pt-2 md:pt-3 border-t border-gray-200 dark:border-gray-600"},qa={class:"text-gray-900 dark:text-gray-100 tabular-nums"},Na={class:"grid grid-cols-4 gap-1.5 md:gap-2"},ja={class:"btn-icon-sm p-2 md:p-3",title:"Imprimer","aria-label":"Imprimer"},Aa={class:"btn-icon-sm p-2 md:p-3",title:"Email","aria-label":"Envoyer par email"},Fa=["disabled"],Va={key:0,class:"animate-spin"},Ra=ge({__name:"TicketPanel",setup(q){const{cartItems:m,subtotalHT:E,totalTVA:B,subtotalTTC:N,total:P,discountAmount:O,fixedTotal:G,setFixedTotal:v,updateQuantity:r,removeFromCart:p,setItemFixedPrice:h,clearCart:k,setDiscount:j,setPayment:A,clearPayments:C,validateSale:g,isProcessing:T,getMaxQuantityForItem:z,error:M}=Ne(),{vendor:x}=et(),{selectedClient:b}=we(),{loadProducts:U}=Ie(),{saveStamps:J,loadClientStamps:se}=Ue(),W=I("euro"),Z=I(0),_=I("card"),u=[{id:"cash",label:"Espèces",icon:wt},{id:"card",label:"CB",icon:Xe},{id:"contactless",label:"Sans contact",icon:Ct},{id:"amex",label:"American Express",icon:Xe},{id:"check",label:"Chèque",icon:mt},{id:"gift_card",label:"Chèque Cadeau",icon:st},{id:"free",label:"Gratuit",icon:$t},{id:"technical",label:"Utilisation technique",icon:ot}],n=R=>R.toFixed(2),c=R=>{W.value=R,R==="percent"&&(Z.value=Math.min(Z.value,100)),j(W.value,Z.value)},f=R=>{const l=R.target,$=Number(l.value);W.value==="percent"?Z.value=Math.min($,100):Z.value=Math.min($,N.value),j(W.value,Z.value)},t=R=>{_.value=R,C(),A(R,P.value)};ve([P,_],()=>{P.value>0&&_.value&&A(_.value,P.value)},{immediate:!0});const o=async()=>{if(m.value.length===0)return;if(!b.value){alert("Veuillez sélectionner ou créer un client avant de valider la vente.");return}A(_.value,P.value);const R=await g(x.value?.id||"demo",b.value?.id);R?(b.value&&x.value&&(await J(b.value.id,x.value.id,R.id),await se(b.value.id)),await U(),alert(`✅ Vente validée !
Ticket: ${R.ticket_number}
Total: ${n(R.total)}€`)):M.value&&alert(`❌ Erreur : ${M.value}`)},w=L(()=>new Date().toLocaleDateString("fr-FR")),V=L(()=>W.value==="percent"?100:N.value);return L(()=>N.value),(R,l)=>(s(),d("div",Vt,[e("div",Rt,[e("div",Dt,[e("div",null,[l[5]||(l[5]=e("p",{class:"text-[10px] md:text-[11px] text-gray-500 uppercase tracking-wider font-semibold mb-1 dark:text-gray-400"},"Date",-1)),e("p",Bt,y(w.value),1)]),l[6]||(l[6]=e("div",{class:"text-right"},[e("p",{class:"text-[10px] md:text-[11px] text-gray-500 uppercase tracking-wider font-semibold mb-1 dark:text-gray-400"},"Ticket"),e("p",{class:"text-xs md:text-sm font-semibold text-gray-900 dark:text-gray-100"},"#001")],-1))])]),e("div",Lt,[a(m).length>0?(s(!0),d(Y,{key:0},ae(a(m),$=>(s(),d("div",{key:$.lineId,class:"cart-item"},[e("div",zt,[e("div",Ut,[e("p",Ht,y($.product.name),1),e("div",Gt,[$.stockCategory==="technical"?(s(),d("span",Kt,"TECH")):H("",!0),$.vendor?(s(),d("p",Ot," par "+y($.vendor.initials||`${$.vendor.first_name} ${$.vendor.last_name}`),1)):H("",!0)])]),e("p",Qt,y(n($.subtotal_ttc))+"€ ",1)]),e("div",Wt,[l[7]||(l[7]=e("label",{class:"text-[10px] text-gray-500 dark:text-gray-400 shrink-0"},"Prix unit. (€)",-1)),e("input",{type:"number",value:$.fixedPriceTTC??"",onInput:ee=>{const Ce=ee.target.value;a(h)($.lineId,Ce===""?null:Math.max(0,Number(Ce)))},min:"0",step:"0.01",placeholder:"Prix libre",class:"flex-1 min-w-0 px-2 py-1.5 text-[11px] bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-gray-400 tabular-nums"},null,40,Zt)]),e("div",Jt,[e("div",Xt,[e("button",{onClick:ee=>a(r)($.lineId,$.quantity-1),class:"w-8 h-8 md:w-9 md:h-9 rounded-lg bg-white border border-gray-300 flex items-center justify-center hover:bg-gray-100 hover:border-gray-400 dark:bg-gray-600 dark:border-gray-500 dark:hover:bg-gray-500 dark:text-gray-100 transition-colors","aria-label":"Diminuer la quantité"},[S(a(at),{class:"w-3.5 h-3.5 md:w-4 md:h-4"})],8,Yt),e("span",ea,y($.quantity),1),e("button",{onClick:ee=>a(r)($.lineId,$.quantity+1),disabled:$.quantity>=a(z)($),class:"w-8 h-8 md:w-9 md:h-9 rounded-lg bg-white border border-gray-300 flex items-center justify-center hover:bg-gray-100 hover:border-gray-400 dark:bg-gray-600 dark:border-gray-500 dark:hover:bg-gray-500 dark:text-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Augmenter la quantité"},[S(a(He),{class:"w-3.5 h-3.5 md:w-4 md:h-4"})],8,ta)]),e("button",{onClick:ee=>a(p)($.lineId),class:"p-1.5 md:p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:text-red-400 dark:hover:bg-red-900/30 rounded-lg transition-colors","aria-label":"Supprimer l'article"},[S(a(rt),{class:"w-3.5 h-3.5 md:w-4 md:h-4"})],8,aa)])]))),128)):(s(),d("div",ra,[...l[8]||(l[8]=[e("p",{class:"text-gray-400 dark:text-gray-500 text-xs md:text-sm"},"Aucun article",-1)])]))]),e("div",sa,[e("div",oa,[e("div",la,[l[13]||(l[13]=e("label",{class:"text-xs md:text-sm text-gray-600 dark:text-gray-400 font-medium"},"Réduction",-1)),e("div",na,[e("button",{onClick:l[0]||(l[0]=$=>c("euro")),class:K(["inline-flex items-center gap-0.5 md:gap-1 px-2 md:px-3 py-1 md:py-1.5 text-[10px] md:text-xs font-semibold rounded-full transition-all duration-150",W.value==="euro"?"bg-white text-gray-900 shadow-sm dark:bg-gray-600 dark:text-gray-100":"text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200"])},[S(a(ut),{class:"w-3 h-3 md:w-3.5 md:h-3.5"}),l[9]||(l[9]=e("span",{class:"hidden sm:inline"},"Montant",-1)),l[10]||(l[10]=e("span",{class:"sm:hidden"},"€",-1))],2),e("button",{onClick:l[1]||(l[1]=$=>c("percent")),class:K(["inline-flex items-center gap-0.5 md:gap-1 px-2 md:px-3 py-1 md:py-1.5 text-[10px] md:text-xs font-semibold rounded-full transition-all duration-150",W.value==="percent"?"bg-white text-gray-900 shadow-sm dark:bg-gray-600 dark:text-gray-100":"text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200"])},[S(a(ht),{class:"w-3 h-3 md:w-3.5 md:h-3.5"}),l[11]||(l[11]=e("span",{class:"hidden sm:inline"},"Pourcentage",-1)),l[12]||(l[12]=e("span",{class:"sm:hidden"},"%",-1))],2)])]),e("div",da,[e("input",{type:"number",value:Z.value,onInput:f,min:"0",max:V.value,step:"0.01",class:"flex-1 px-3 md:px-4 py-2 md:py-2.5 bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 border border-gray-300 rounded-lg text-xs md:text-sm text-right focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30 hover:border-gray-400 transition-all tabular-nums"},null,40,ia),e("span",ca,y(W.value==="percent"?"%":"€"),1)])])]),e("div",ua,[e("div",ma,[l[14]||(l[14]=e("label",{class:"text-xs md:text-sm text-gray-600 dark:text-gray-400 font-medium"},"Fixer le prix total (€)",-1)),e("div",pa,[e("input",{type:"number",value:a(G)??"",onInput:l[2]||(l[2]=$=>{const ee=$.target.value;a(v)(ee===""?null:Math.max(0,Number(ee)))}),min:"0",step:"0.01",placeholder:"Prix libre",class:"flex-1 px-3 md:px-4 py-2 md:py-2.5 bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-500 border border-gray-300 rounded-lg text-xs md:text-sm text-right focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30 tabular-nums"},null,40,ga),a(G)!=null?(s(),d("button",{key:0,type:"button",onClick:l[3]||(l[3]=$=>a(v)(null)),class:"px-2 py-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:text-red-400 dark:hover:bg-red-900/30 rounded-lg text-xs font-medium",title:"Annuler le prix fixé"}," Réinit ")):H("",!0)])])]),e("div",ya,[l[15]||(l[15]=e("p",{class:"text-[10px] md:text-[11px] text-gray-600 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2 md:mb-3"},"Règlement",-1)),e("div",va,[(s(),d(Y,null,ae(u,$=>e("button",{key:$.id,onClick:ee=>t($.id),class:K(["payment-btn text-[10px] md:text-xs",_.value===$.id&&"active"])},[(s(),de(Pe($.icon),{class:"w-3.5 h-3.5 md:w-4 md:h-4"})),e("span",ba,y($.label),1)],10,xa)),64))])]),e("div",ha,[e("div",fa,[e("div",ka,[l[16]||(l[16]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Sous-total HT",-1)),e("span",_a,y(n(a(E)))+"€",1)]),e("div",wa,[l[17]||(l[17]=e("span",{class:"text-gray-500 dark:text-gray-400"},"TVA (20%)",-1)),e("span",Ca,y(n(a(B)))+"€",1)]),e("div",$a,[l[18]||(l[18]=e("span",{class:"text-gray-600 dark:text-gray-400"},"Sous-total TTC",-1)),e("span",Sa,y(n(a(N)))+"€",1)]),Z.value>0?(s(),d("div",Ta,[e("span",Pa,[l[19]||(l[19]=oe(" Réduction ",-1)),e("span",Ea,"("+y(W.value==="percent"?`${Z.value}%`:`${n(Z.value)}€`)+")",1)]),e("span",Ia,"-"+y(n(a(O)))+"€",1)])):H("",!0),e("div",Ma,[l[20]||(l[20]=e("span",{class:"text-gray-900 dark:text-gray-100"},"Total",-1)),e("span",qa,y(n(a(P)))+"€",1)])]),e("div",Na,[e("button",ja,[S(a(kt),{class:"w-3.5 h-3.5 md:w-4 md:h-4"})]),e("button",Aa,[S(a(xt),{class:"w-3.5 h-3.5 md:w-4 md:h-4"})]),e("button",{onClick:l[4]||(l[4]=(...$)=>a(k)&&a(k)(...$)),class:"btn-icon-sm p-2 md:p-3 text-orange-600 hover:bg-orange-50 hover:border-orange-200 dark:text-orange-400 dark:hover:bg-orange-900/30 dark:hover:border-orange-700",title:"Annuler","aria-label":"Annuler la transaction"},[S(a(lt),{class:"w-3.5 h-3.5 md:w-4 md:h-4"})]),e("button",{onClick:o,disabled:a(m).length===0||a(T),class:K(["btn-icon-sm p-2 md:p-3",a(m).length>0&&!a(T)?"bg-emerald-600 text-white hover:bg-emerald-700 border-emerald-600 dark:bg-emerald-600 dark:border-emerald-600":"bg-gray-100 text-gray-400 cursor-not-allowed border-gray-200 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-500"]),title:"Valider","aria-label":"Valider la transaction"},[a(T)?(s(),d("span",Va,"⏳")):(s(),de(a(ze),{key:1,class:"w-4 h-4 md:w-5 md:h-5"}))],10,Fa)])])]))}}),Da=["aria-label"],Ba={class:"service-header"},La={class:"service-header-left"},za={class:"service-code"},Ua=["aria-label"],Ha={class:"service-price"},Ga={class:"service-body"},Ka={class:"service-name"},Oa={key:0,class:"service-duration"},Qa={class:"hidden sm:inline"},Wa={class:"sm:hidden"},Za=ge({__name:"ServiceCard",props:{service:{}},setup(q){const m=q,{addToCart:E,cartItems:B}=Ne(),{getCategoryBorderColor:N}=Ie(),P=L(()=>{const v=B.value.find(r=>r.product.id===m.service.id);return v?v.quantity:0}),O=L(()=>N(m.service)),G=()=>{E(m.service)};return(v,r)=>(s(),d("button",{onClick:G,"aria-label":`Ajouter ${q.service.name} au panier`,class:K(["service-card",O.value,P.value>0&&"active"])},[e("div",Ba,[e("div",La,[e("span",za,y(q.service.code),1),P.value>0?(s(),d("span",{key:0,class:"quantity-badge","aria-label":`Quantité: ${P.value}`},y(P.value),9,Ua)):H("",!0)]),e("span",Ha,y(q.service.price_ttc?.toFixed(2)||q.service.price_ht?.toFixed(2))+"€ ",1)]),e("div",Ga,[e("h3",Ka,y(q.service.name),1),q.service.duration?(s(),d("span",Oa,[S(a(St),{class:"w-3 h-3 md:w-3.5 md:h-3.5"}),e("span",Qa,y(q.service.duration)+"min",1),e("span",Wa,y(q.service.duration)+"'",1)])):H("",!0)])],10,Da))}}),Ja=_t(Za,[["__scopeId","data-v-588d3745"]]),Xa={class:"card p-4"},Ya={class:"flex items-center justify-between mb-3"},er={class:"flex items-center gap-2"},tr={class:"w-8 h-8 rounded-full bg-yellow-100 dark:bg-yellow-900/40 flex items-center justify-center"},ar={class:"text-xs text-gray-500 dark:text-gray-400"},rr={class:"flex items-center gap-2"},sr=["disabled"],or=["disabled"],lr={key:3,class:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 dark:bg-emerald-900/40 dark:text-emerald-300 rounded-full text-xs font-semibold"},nr={class:"grid grid-cols-6 sm:grid-cols-12 gap-2 w-full"},dr=["onClick"],ir={key:0,class:"absolute bottom-0.5 left-0 right-0 text-xs text-yellow-700 dark:text-amber-300 font-semibold leading-tight"},cr=ge({__name:"LoyaltyCard",setup(q){const{stamps:m,checkedCount:E,isCardComplete:B,stampsCount:N,toggleStamp:P,addPointsManually:O,removePointsManually:G,resetPointsToZero:v,loadClientStamps:r}=Ue(),{selectedClient:p}=we(),{vendor:h}=et(),k=I(!1),j=L(()=>m.value.filter(M=>M.isStamped&&!M.date).length),A=L(()=>m.value.filter(M=>M.markedForRemoval).length),C=async()=>{if(!(!p.value||!h.value||j.value===0)){k.value=!0;try{const M=await O(p.value.id,h.value.id);M?.success?(await r(p.value.id),alert(`${M.count} point(s) fidélité ajouté(s)`)):alert("Erreur lors de l'ajout des points")}catch{alert("Erreur lors de l'ajout des points")}finally{k.value=!1}}},g=async()=>{if(!(!p.value||A.value===0)&&confirm(`Retirer ${A.value} point(s) fidélité ?`)){k.value=!0;try{const M=await G(p.value.id);M?.success?(await r(p.value.id),alert(`${M.count} point(s) fidélité retiré(s)`)):alert("Erreur lors du retrait des points")}catch{alert("Erreur lors du retrait des points")}finally{k.value=!1}}},T=async()=>{if(!(!p.value||!confirm("Réinitialiser les points fidélité à 0 ?")))try{await v(p.value.id),await r(p.value.id)}catch{alert("Erreur lors de la réinitialisation")}},z=M=>{if(!M)return"";const x=new Date(M),b=String(x.getDate()).padStart(2,"0"),U=String(x.getMonth()+1).padStart(2,"0"),J=x.getFullYear();return`${b}/${U}/${J}`};return(M,x)=>(s(),d("div",Xa,[e("div",Ya,[e("div",er,[e("div",tr,[S(a(st),{class:"w-4 h-4 text-yellow-600 dark:text-yellow-400"})]),x[0]||(x[0]=e("span",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"Carte fidélité",-1)),e("span",ar,y(a(E))+"/"+y(a(N)),1)]),e("div",rr,[a(p)&&j.value>0?(s(),d("button",{key:0,type:"button",onClick:C,disabled:k.value,class:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-yellow-700 bg-yellow-100 hover:bg-yellow-200 dark:text-amber-300 dark:bg-amber-900/50 dark:hover:bg-amber-900/70 rounded-lg transition-colors disabled:opacity-50",title:"Enregistrer les points cochés (sans vente)"},[S(a(He),{class:"w-3.5 h-3.5"}),oe(" "+y(k.value?"Enregistrement...":`+${j.value} point(s)`),1)],8,sr)):H("",!0),a(p)&&A.value>0?(s(),d("button",{key:1,type:"button",onClick:g,disabled:k.value,class:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-red-700 bg-red-100 hover:bg-red-200 dark:text-red-300 dark:bg-red-900/50 dark:hover:bg-red-900/70 rounded-lg transition-colors disabled:opacity-50",title:"Retirer les points sélectionnés"},[S(a(at),{class:"w-3.5 h-3.5"}),oe(" "+y(k.value?"Retrait...":`-${A.value} point(s)`),1)],8,or)):H("",!0),a(p)?(s(),d("button",{key:2,type:"button",onClick:T,class:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:text-red-400 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:"Réinitialiser les points à 0"},[S(a(lt),{class:"w-3.5 h-3.5"}),x[1]||(x[1]=oe(" Réinit. points ",-1))])):H("",!0),a(B)?(s(),d("span",lr,[S(a(ze),{class:"w-3.5 h-3.5"}),x[2]||(x[2]=oe(" Complète ",-1))])):H("",!0)])]),e("div",nr,[(s(!0),d(Y,null,ae(a(m),b=>(s(),d("button",{key:b.position,onClick:U=>a(P)(b.position),class:K(["relative aspect-square w-full max-w-none rounded-xl border-2 transition-all duration-200 flex flex-col items-center justify-center overflow-hidden",b.markedForRemoval?"border-red-500 bg-red-50 dark:border-red-500 dark:bg-red-900/30 ring-2 ring-red-400":b.isStamped?"border-yellow-500 bg-yellow-50 hover:bg-yellow-100 dark:border-amber-500 dark:bg-amber-900/30 dark:hover:bg-amber-900/50":"border-gray-300 bg-white hover:bg-gray-50 hover:border-gray-400 dark:border-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600 dark:hover:border-gray-500"])},[e("span",{class:K(["text-base font-bold",b.markedForRemoval?"text-red-600 dark:text-red-400 line-through":b.isStamped?"text-yellow-600 dark:text-amber-400":"text-gray-400 dark:text-gray-500"])},y(b.position),3),S(qe,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"scale-0 opacity-0","enter-to-class":"scale-100 opacity-100"},{default:Me(()=>[b.isStamped?(s(),d("div",{key:0,class:K(["absolute inset-0 flex items-center justify-center",b.markedForRemoval?"bg-red-500/20 dark:bg-red-500/30":"bg-yellow-500/20 dark:bg-amber-500/30"])},[S(a(ze),{class:K(["w-6 h-6 drop-shadow",b.markedForRemoval?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-amber-400"])},null,8,["class"])],2)):H("",!0)]),_:2},1024),b.isStamped&&b.date?(s(),d("span",ir,y(z(b.date)),1)):H("",!0)],10,dr))),128))])]))}}),ur={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-2xl max-h-[85vh] flex flex-col border border-gray-200 dark:border-gray-700 overflow-hidden",role:"dialog","aria-modal":"true","aria-labelledby":"product-picker-title"},mr={class:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 shrink-0"},pr={id:"product-picker-title",class:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2"},gr={class:"px-4 py-3 border-b border-gray-100 dark:border-gray-700 shrink-0"},yr={class:"flex rounded-xl border border-gray-200 dark:border-gray-600 overflow-hidden mb-3"},vr={class:"relative"},xr={class:"flex-1 overflow-y-auto p-4"},br={key:0},hr={class:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 sticky top-0 bg-white dark:bg-gray-800 py-1"},fr={class:"space-y-4"},kr={class:"p-3 flex items-center justify-between"},_r={class:"min-w-0 flex-1"},wr={class:"font-medium text-gray-900 dark:text-white truncate"},Cr={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},$r={class:"px-3 pb-3 flex flex-wrap gap-2"},Sr=["onClick","disabled"],Tr={class:"text-xs opacity-90"},Pr=["onClick","disabled"],Er={class:"text-xs opacity-90"},Ir={key:1,class:"flex flex-col items-center justify-center py-16 text-gray-500 dark:text-gray-400"},Mr=ge({__name:"ProductPickerDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(q,{emit:m}){const E=q,B=m,{physicalProducts:N,loadProducts:P}=Ie(),{addToCart:O}=Ne(),G=I(""),v=I("sale"),r=L({get:()=>E.modelValue,set:C=>B("update:modelValue",C)});ve(r,C=>{if(C){P(),G.value="",v.value="sale";const g=T=>{T.key==="Escape"&&A()};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)}});const p=L(()=>{const C=G.value.trim().toLowerCase();let g=N.value;return C&&(g=g.filter(T=>T.name.toLowerCase().includes(C)||T.brand?.toLowerCase().includes(C)||T.model?.toLowerCase().includes(C)||T.code?.toLowerCase().includes(C)||T.barcode?.toLowerCase().includes(C))),g}),h=C=>v.value==="technical"?C.stock_technical??0:C.stock,k=L(()=>{const C=new Map;for(const T of p.value){const z=T.brand?.trim()||"Sans marque";C.has(z)||C.set(z,[]),C.get(z).push(T)}const g=[];for(const[T,z]of C){const M=new Map;for(const b of z){const U=`${b.name}|${b.model??""}`;M.has(U)||M.set(U,[]),M.get(U).push(b)}const x=[];for(const[,b]of M){const U=b[0].model?`${b[0].name} ${b[0].model}`:b[0].name;x.push({displayName:U,variants:b.map(J=>({product:J,size:J.size??null,stockSale:J.stock??0,stockTech:J.stock_technical??0}))})}x.sort((b,U)=>b.displayName.localeCompare(U.displayName)),g.push({brand:T,models:x})}return g.sort((T,z)=>T.brand.localeCompare(z.brand)),g}),j=C=>{h(C)<=0||O(C,1,void 0,v.value)},A=()=>{r.value=!1};return(C,g)=>(s(),de(pt,{to:"body"},[S(qe,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:Me(()=>[r.value?(s(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:tt(A,["self"])},[e("div",ur,[e("div",mr,[e("h2",pr,[S(a(Le),{class:"w-5 h-5 text-gray-500 dark:text-gray-400"}),g[3]||(g[3]=oe(" Ajouter un produit ",-1))]),e("button",{onClick:A,class:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 dark:hover:text-gray-400 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Fermer"},[S(a(Tt),{class:"w-5 h-5"})])]),e("div",gr,[e("div",yr,[e("button",{onClick:g[0]||(g[0]=T=>v.value="sale"),class:K(["flex-1 px-4 py-2.5 text-sm font-medium transition-colors flex items-center justify-center gap-2",v.value==="sale"?"bg-emerald-600 text-white":"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600"])},[S(a(Pt),{class:"w-4 h-4"}),g[4]||(g[4]=oe(" Produit de vente ",-1))],2),e("button",{onClick:g[1]||(g[1]=T=>v.value="technical"),class:K(["flex-1 px-4 py-2.5 text-sm font-medium transition-colors flex items-center justify-center gap-2",v.value==="technical"?"bg-blue-600 text-white":"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600"])},[S(a(ot),{class:"w-4 h-4"}),g[5]||(g[5]=oe(" Utilisation technique ",-1))],2)]),e("div",vr,[S(a(Ee),{class:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-gray-500 pointer-events-none"}),me(e("input",{"onUpdate:modelValue":g[2]||(g[2]=T=>G.value=T),type:"text",placeholder:"Rechercher par nom, marque, code...",class:"w-full pl-11 pr-4 py-2.5 bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-gray-900 dark:focus:ring-emerald-500 focus:border-transparent",autofocus:""},null,512),[[pe,G.value]])])]),e("div",xr,[k.value.length>0?(s(),d("div",br,[(s(!0),d(Y,null,ae(k.value,({brand:T,models:z})=>(s(),d("div",{key:T,class:"mb-6 last:mb-0"},[e("h3",hr,y(T),1),e("div",fr,[(s(!0),d(Y,null,ae(z,M=>(s(),d("div",{key:`${T}-${M.variants[0].product.id}`,class:"rounded-xl border border-gray-200 dark:border-gray-600 overflow-hidden bg-gray-50/50 dark:bg-gray-900/30"},[e("div",kr,[e("div",_r,[e("p",wr,y(M.displayName),1),e("p",Cr,y(M.variants[0].product.price_ttc?.toFixed(2))+"€ ",1)])]),e("div",$r,[(s(!0),d(Y,null,ae(M.variants,x=>(s(),d(Y,{key:x.product.id},[x.size?(s(),d("button",{key:0,onClick:b=>j(x.product),disabled:(v.value==="sale"?x.stockSale:x.stockTech)<=0,class:K(["inline-flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors",(v.value==="sale"?x.stockSale:x.stockTech)>0?v.value==="sale"?"bg-emerald-600 text-white hover:bg-emerald-700 dark:bg-emerald-500 dark:hover:bg-emerald-600":"bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 cursor-not-allowed"])},[e("span",null,y(x.size),1),e("span",Tr,"("+y(v.value==="sale"?x.stockSale:x.stockTech)+")",1)],10,Sr)):(s(),d("button",{key:1,onClick:b=>j(x.product),disabled:(v.value==="sale"?x.stockSale:x.stockTech)<=0,class:K(["inline-flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors",(v.value==="sale"?x.stockSale:x.stockTech)>0?v.value==="sale"?"bg-emerald-600 text-white hover:bg-emerald-700 dark:bg-emerald-500 dark:hover:bg-emerald-600":"bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 cursor-not-allowed"])},[S(a(He),{class:"w-4 h-4"}),g[6]||(g[6]=e("span",null,"Ajouter",-1)),e("span",Er,"("+y(v.value==="sale"?x.stockSale:x.stockTech)+")",1)],10,Pr))],64))),128))])]))),128))])]))),128))])):(s(),d("div",Ir,[S(a(Le),{class:"w-12 h-12 mb-4 opacity-40"}),g[7]||(g[7]=e("p",{class:"text-sm font-medium"},"Aucun produit trouvé",-1)),g[8]||(g[8]=e("p",{class:"text-xs mt-1"},"Modifiez votre recherche",-1))]))])])])):H("",!0)]),_:1})]))}}),qr={class:"card flex flex-col bg-white dark:bg-gray-800 h-full"},Nr={class:"p-4 md:p-6 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 space-y-3"},jr={class:"flex gap-2"},Ar={class:"relative"},Fr={class:"flex items-center gap-3"},Vr={class:"relative flex-1"},Rr={key:0,class:"text-xs text-red-500 dark:text-red-400 mt-1.5"},Dr={class:"space-y-1"},Br={class:"flex gap-2"},Lr={class:"relative flex-1"},zr=["onKeydown"],Ur={key:0,class:"text-xs text-red-600 dark:text-red-400"},Hr={class:"relative"},Gr={class:"relative"},Kr=["value"],Or={key:0,class:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-gray-700 rounded-xl shadow-xl border border-gray-200 dark:border-gray-600 py-2 z-50 max-h-60 md:max-h-80 overflow-y-auto"},Qr=["onClick"],Wr={class:"flex-1 min-w-0"},Zr={class:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate"},Jr={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Xr={class:"flex items-center gap-2 md:gap-3 ml-2 md:ml-3"},Yr={class:"text-sm font-bold text-gray-900 dark:text-gray-100 tabular-nums"},es={key:0,class:"text-xs text-gray-400 dark:text-gray-500 hidden sm:inline"},ts={class:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-800 space-y-4"},as={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2.5 md:gap-3.5"},rs={key:1,class:"h-full flex flex-col items-center justify-center text-gray-400 dark:text-gray-500 py-12"},ss=ge({__name:"ServiceGrid",setup(q){const{products:m,searchProducts:E,findByBarcode:B}=Ie(),{addToCart:N}=Ne(),{selectedClient:P}=we(),{loadClientStamps:O,clearStamps:G}=Ue(),v=I([]);(async()=>{const{data:c}=await F.from("vendors").select("*").eq("is_active",!0);v.value=c||[]})(),ve(P,c=>{c?O(c.id):G()});const p=I(!1),h=I(""),k=I(!1),j=I([]),A=I(""),C=I(""),g=I(""),T=I(""),z=L(()=>{const c=h.value.toLowerCase().trim(),f=m.value.filter(t=>t.type==="service"&&t.is_active!==!1).slice().sort((t,o)=>String(t.code??"").localeCompare(String(o.code??""),void 0,{numeric:!0}));return c?f.filter(t=>t.name.toLowerCase().includes(c)||t.code?.toLowerCase().includes(c)):f});ve(z,c=>{console.log("Services affichés:",c.length)},{immediate:!0});const M=async c=>{const f=c.target;if(h.value=f.value,f.value.trim().length>=2){const t=await E(f.value);j.value=(t||[]).filter(o=>o.type==="service"),k.value=j.value.length>0}else j.value=[],k.value=!1},x=()=>{h.value.trim().length>=2&&j.value.length>0&&(k.value=!0)},b=()=>{setTimeout(()=>{k.value=!1},200)},U=c=>{h.value=c.name,k.value=!1},J=c=>{if(c.key==="Enter"&&j.value.length>0){c.preventDefault();const f=j.value[0];N(f),h.value="",j.value=[],k.value=!1}},se=async()=>{const c=g.value.trim();if(!c)return;T.value="";const f=await B(c);f?(N(f,1),g.value=""):(T.value="Produit non trouvé ou sans code-barres",setTimeout(()=>{T.value=""},3e3))};ve(h,c=>{c.trim().length<2&&(j.value=[],k.value=!1)});const W=c=>{const f=c.trim().toUpperCase();if(f.length<2)return null;const t=f.match(/^([A-Z]+)(\d+.*)$/);return t?{vendorInitials:t[1],productCode:t[2]}:null},Z=c=>v.value.find(f=>f.initials?.toUpperCase()===c.toUpperCase()),_=c=>m.value.find(f=>f.code?.toUpperCase()===c.toUpperCase()),u=c=>{c.key==="Enter"&&(c.preventDefault(),n())},n=()=>{C.value="";const c=W(A.value);if(!c){C.value="Format invalide (ex: VL1)";return}const f=Z(c.vendorInitials);if(!f){C.value=`Vendeur "${c.vendorInitials}" non trouvé`;return}const t=_(c.productCode);if(!t){C.value=`Service "${c.productCode}" non trouvé`;return}N(t,1,f),A.value="",C.value=""};return(c,f)=>(s(),d("div",qr,[e("div",Nr,[e("div",jr,[e("button",{onClick:f[0]||(f[0]=t=>p.value=!0),class:"inline-flex items-center gap-2 px-4 py-2.5 bg-gray-900 dark:bg-emerald-600 dark:hover:bg-emerald-500 text-white rounded-xl font-medium hover:bg-gray-800 transition-colors text-sm"},[S(a(Le),{class:"w-4 h-4"}),f[4]||(f[4]=oe(" Produits ",-1))])]),e("div",Ar,[e("div",Fr,[e("div",Vr,[S(a(Nt),{class:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-amber-500 dark:text-amber-400 pointer-events-none z-10"}),me(e("input",{"onUpdate:modelValue":f[1]||(f[1]=t=>A.value=t),onKeydown:u,type:"text",placeholder:"Raccourci (ex: VL1)",class:"w-full pl-11 pr-4 py-2.5 bg-amber-50 dark:bg-gray-700 dark:border-amber-600/50 dark:text-gray-100 border border-amber-300 rounded-xl text-sm font-mono font-semibold uppercase focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 dark:focus:border-amber-400 dark:focus:ring-amber-400/30 hover:border-amber-400 transition-all placeholder:normal-case placeholder:font-normal dark:placeholder-gray-400",autocomplete:"off"},null,544),[[pe,A.value]])]),e("button",{onClick:n,class:"px-4 py-2.5 bg-amber-500 dark:bg-amber-600 text-white rounded-xl font-medium hover:bg-amber-600 dark:hover:bg-amber-500 transition-colors text-sm"}," OK ")]),C.value?(s(),d("p",Rr,y(C.value),1)):H("",!0)]),e("div",Dr,[f[5]||(f[5]=e("label",{class:"block text-[10px] md:text-xs text-gray-500 dark:text-gray-400 font-semibold uppercase tracking-wider"},"Scan code-barres",-1)),e("div",Br,[e("div",Lr,[S(a(It),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-gray-500 pointer-events-none"}),me(e("input",{"onUpdate:modelValue":f[2]||(f[2]=t=>g.value=t),type:"text",placeholder:"Scannez le code-barres du produit...",class:"w-full pl-10 pr-4 py-2.5 md:py-3 bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 border border-gray-300 rounded-xl text-sm font-medium focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30",autocomplete:"off",onKeydown:gt(tt(se,["prevent"]),["enter"])},null,40,zr),[[pe,g.value]])]),e("button",{type:"button",onClick:se,class:"px-4 py-2.5 bg-gray-900 dark:bg-emerald-600 dark:hover:bg-emerald-500 text-white rounded-xl text-sm font-medium hover:bg-gray-800"}," Ajouter ")]),T.value?(s(),d("p",Ur,y(T.value),1)):H("",!0)]),e("div",Hr,[e("div",Gr,[S(a(Ee),{class:"absolute left-4 md:left-5 top-1/2 -translate-y-1/2 w-4 h-4 md:w-5 md:h-5 text-gray-400 dark:text-gray-500 pointer-events-none z-10"}),e("input",{value:h.value,onInput:M,onFocus:x,onBlur:b,onKeydown:J,type:"text",placeholder:"Rechercher un service...",class:"w-full pl-11 md:pl-14 pr-4 md:pr-5 py-3 md:py-3.5 bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 border border-gray-300 rounded-xl text-sm font-medium focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30 hover:border-gray-400 transition-all",autocomplete:"off"},null,40,Kr)]),S(qe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"opacity-0 translate-y-1","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-75","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-1"},{default:Me(()=>[k.value&&j.value.length>0?(s(),d("div",Or,[(s(!0),d(Y,null,ae(j.value,t=>(s(),d("button",{key:t.id,onClick:o=>U(t),class:"w-full px-4 md:px-5 py-2.5 md:py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors flex items-center justify-between"},[e("div",Wr,[e("p",Zr,y(t.name),1),e("p",Jr,y(t.code),1)]),e("div",Xr,[e("span",Yr,y(t.price_ttc?.toFixed(2))+"€",1),t.duration?(s(),d("span",es,y(t.duration)+"min",1)):H("",!0)])],8,Qr))),128))])):H("",!0)]),_:1})])]),e("div",ts,[z.value.length>0?(s(),d("div",as,[(s(!0),d(Y,null,ae(z.value,t=>(s(),de(Ja,{key:t.id,service:t},null,8,["service"]))),128))])):(s(),d("div",rs,[S(a(Ee),{class:"w-10 h-10 md:w-14 md:h-14 mb-4 opacity-40"}),f[6]||(f[6]=e("p",{class:"text-sm md:text-base font-medium text-gray-500 dark:text-gray-400"},"Aucun service trouvé",-1)),f[7]||(f[7]=e("p",{class:"text-xs md:text-sm text-gray-400 dark:text-gray-500 mt-1.5"},"Modifiez votre recherche",-1))])),a(P)?(s(),de(cr,{key:2})):H("",!0)]),S(Mr,{modelValue:p.value,"onUpdate:modelValue":f[3]||(f[3]=t=>p.value=t)},null,8,["modelValue"])]))}}),D=I({id:"",firstName:"",lastName:"",phone:"",phone2:"",email:"",address:"",city:"",postalCode:"",birthDate:"",notes:"",company:""}),_e=I(!1);function os(){const{createClient:q,updateClient:m,selectClient:E}=we(),B=L(()=>!!(D.value.firstName.trim()||D.value.lastName.trim()||D.value.phone.trim())),N=()=>{D.value={id:"",firstName:"",lastName:"",phone:"",phone2:"",email:"",address:"",city:"",postalCode:"",birthDate:"",notes:"",company:""},_e.value=!1,E(null)};return{currentClient:D,isEditMode:_e,hasClientInfo:B,clearClient:N,loadClient:v=>{D.value={...v},_e.value=!0},newClient:()=>{N()},saveClient:async()=>{if(!B.value)return{success:!1,isNew:!1,message:"Veuillez remplir au moins un champ (nom, prénom ou téléphone)"};if(!D.value.phone.trim())return{success:!1,isNew:!1,message:"Le numéro de téléphone est obligatoire"};try{const v={first_name:D.value.firstName,last_name:D.value.lastName,phone:D.value.phone,phone2:D.value.phone2||null,email:D.value.email||null,address:D.value.address||null,city:D.value.city||null,postal_code:D.value.postalCode||null,birth_date:D.value.birthDate||null,notes:D.value.notes||null,company:D.value.company?.trim()||null};if(_e.value&&D.value.id){console.log("Mise à jour du client:",v);const r=await m(D.value.id,v);return r?(E(r),{success:!0,isNew:!1,message:`Client ${D.value.firstName} ${D.value.lastName} mis à jour`}):{success:!1,isNew:!1,message:"Erreur lors de la mise à jour"}}else{console.log("Création du client:",v);const r=await q(v);return r?(D.value.id=r.id,_e.value=!0,E(r),{success:!0,isNew:!0,message:`Client ${D.value.firstName} ${D.value.lastName} créé`}):{success:!1,isNew:!1,message:"Erreur lors de la création"}}}catch(v){return console.error("Erreur lors de l'enregistrement du client:",v),{success:!1,isNew:!1,message:"Erreur lors de l'enregistrement"}}}}}const ls={class:"card h-full flex flex-col overflow-hidden"},ns={class:"p-4 md:p-6 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},ds={class:"flex items-center justify-between mb-3 md:mb-4"},is={class:"relative"},cs={key:0,class:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-gray-700 rounded-xl shadow-xl border border-gray-200 dark:border-gray-600 py-2 z-50"},us=["onClick"],ms={class:"text-xs md:text-sm font-medium text-gray-900 dark:text-gray-100"},ps={class:"text-[10px] md:text-xs text-gray-500 dark:text-gray-400 mt-0.5"},gs={class:"flex-1 overflow-y-auto p-4 md:p-6 min-h-0 space-y-4 md:space-y-5 bg-gray-50 dark:bg-gray-800"},ys={class:"grid grid-cols-2 gap-3 md:gap-4"},vs={class:"block text-[10px] md:text-xs text-gray-600 dark:text-gray-400 font-semibold uppercase tracking-wider"},xs=["value","type","placeholder","maxlength","inputmode","autocomplete","onInput"],bs={class:"block text-[10px] md:text-xs text-gray-600 dark:text-gray-400 font-semibold uppercase tracking-wider"},hs=["value","type","placeholder","onInput"],fs={key:0,class:"col-span-2 flex items-center gap-3 p-3 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl"},ks=["checked"],_s={class:"col-span-2 space-y-1.5 md:space-y-2"},ws={class:"block text-[10px] md:text-xs text-gray-600 dark:text-gray-400 font-semibold uppercase tracking-wider flex items-center gap-1.5 md:gap-2"},Cs={class:"grid grid-cols-2 gap-3 md:gap-4"},$s={class:"space-y-1.5 md:space-y-2"},Ss={class:"space-y-1.5 md:space-y-2"},Ts=["value","maxlength"],Ps={class:"space-y-1.5 md:space-y-2"},Es={class:"p-4 md:p-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},Is={class:"grid grid-cols-3 gap-2 md:gap-3"},Ms=["disabled"],qs=["disabled"],Ns=["disabled"],js={class:"hidden sm:inline"},As=ge({__name:"ClientPanel",setup(q){const{currentClient:m,isEditMode:E,clearClient:B,loadClient:N,hasClientInfo:P,saveClient:O}=os(),{searchClients:G,selectClient:v,clearSelection:r,selectedClient:p,invoiceInCompanyName:h,setInvoiceInCompanyName:k}=we(),j=I(""),A=I([]),C=I(!1);let g=null;ve(j,_=>{if(g&&clearTimeout(g),_.trim().length<2){A.value=[];return}g=window.setTimeout(async()=>{C.value=!0;try{const u=await G(_);A.value=u}catch(u){console.error("Erreur recherche clients:",u),A.value=[]}finally{C.value=!1}},300)});const T=L(()=>j.value.trim().length>=2&&A.value.length>0),z=async()=>{const _=await O();_.success,alert(_.message)},M=()=>{B(),j.value="",r()},x=()=>{alert("Historique client à implémenter")},b=_=>{v(_),k(!1);const u={id:_.id,firstName:_.first_name,lastName:_.last_name,phone:je(_.phone||""),phone2:je(_.phone2||""),email:_.email||"",address:_.address||"",city:_.city||"",postalCode:Je(_.postal_code||""),birthDate:_.birth_date||"",notes:_.notes||"",company:_.company||""};N(u),j.value=`${u.firstName} ${u.lastName}`,A.value=[]},U=_=>{const u=A.value[0];_.key==="Enter"&&u&&(_.preventDefault(),b(u))},J=[{key:"lastName",label:"Nom",type:"text",placeholder:"Dupont",span:1,format:null},{key:"firstName",label:"Prénom",type:"text",placeholder:"Jean",span:1,format:null},{key:"phone",label:"Tél. 1",type:"tel",placeholder:"06 12 34 56 78",span:1,format:"phone"},{key:"phone2",label:"Tél. 2",type:"tel",placeholder:"01 23 45 67 89",span:1,format:"phone"},{key:"email",label:"Email",type:"email",placeholder:"jean@email.com",span:2,format:null},{key:"birthDate",label:"Anniversaire",type:"date",placeholder:"",span:2,format:null},{key:"company",label:"Entreprise",type:"text",placeholder:"Nom de l'entreprise (optionnel)",span:2,format:null}];function se(_,u,n){const c=n==="phone"?je(u):u;m.value[_]=c}function W(_,u){m.value[_]=u}function Z(_){m.value.postalCode=Je(_)}return(_,u)=>(s(),d("div",ls,[e("div",ns,[e("div",ds,[u[6]||(u[6]=e("h2",{class:"text-xs md:text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"Client",-1)),a(P)?(s(),d("div",{key:0,class:K(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] md:text-xs font-semibold transition-colors",a(E)?"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300":"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300"])},[(s(),de(Pe(a(E)?a(Mt):a(We)),{class:"w-3 h-3"})),e("span",null,y(a(E)?"Modification":"Nouveau"),1)],2)):H("",!0)]),e("div",is,[S(a(Ee),{class:"absolute left-4 md:left-5 top-1/2 -translate-y-1/2 w-4 h-4 md:w-5 md:h-5 text-gray-400 dark:text-gray-500 pointer-events-none z-10"}),me(e("input",{"onUpdate:modelValue":u[0]||(u[0]=n=>j.value=n),onKeydown:U,type:"text",placeholder:"Rechercher un client...",class:"w-full pl-11 md:pl-14 pr-4 md:pr-5 py-3 md:py-3.5 bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 border border-gray-300 rounded-xl text-xs md:text-sm font-medium focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30 hover:border-gray-400 transition-all",autocomplete:"off"},null,544),[[pe,j.value]]),S(qe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"opacity-0 translate-y-1","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-75","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-1"},{default:Me(()=>[T.value?(s(),d("div",cs,[(s(!0),d(Y,null,ae(A.value,n=>(s(),d("button",{key:n.id,onClick:c=>b(n),class:"w-full px-4 md:px-5 py-2.5 md:py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors"},[e("p",ms,y(n.first_name)+" "+y(n.last_name),1),e("p",ps,y(n.phone),1)],8,us))),128))])):H("",!0)]),_:1})])]),e("div",gs,[e("div",ys,[(s(!0),d(Y,null,ae(J.filter(n=>n.span!==2),n=>(s(),d("div",{key:n.key,class:"space-y-1.5 md:space-y-2"},[e("label",vs,y(n.label),1),e("input",{value:a(m)[n.key],type:n.type,placeholder:n.placeholder,maxlength:n.format==="phone"?a(Ze).phone:void 0,inputmode:n.format==="phone"?"numeric":void 0,autocomplete:n.format==="phone"?"tel":void 0,class:"w-full px-3 md:px-4 py-2.5 md:py-3 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 border border-gray-300 rounded-xl text-xs md:text-sm font-medium focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30 hover:border-gray-400 transition-all",onInput:c=>se(n.key,c.target.value,n.format)},null,40,xs)]))),128)),(s(!0),d(Y,null,ae(J.filter(n=>n.span===2),n=>(s(),d("div",{key:n.key,class:"col-span-2 space-y-1.5 md:space-y-2"},[e("label",bs,y(n.label),1),e("input",{value:a(m)[n.key],type:n.type,placeholder:n.placeholder,class:"w-full px-3 md:px-4 py-2.5 md:py-3 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 border border-gray-300 rounded-xl text-xs md:text-sm font-medium focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30 hover:border-gray-400 transition-all",onInput:c=>n.format?se(n.key,c.target.value,n.format):W(n.key,c.target.value)},null,40,hs)]))),128))]),a(p)?(s(),d("div",fs,[e("input",{id:"cb-invoice-company",type:"checkbox",checked:a(h),onChange:u[1]||(u[1]=n=>a(k)(n.target.checked)),class:"w-4 h-4 rounded border-gray-300 dark:border-gray-500 text-gray-900 dark:bg-gray-600 focus:ring-gray-900 dark:focus:ring-emerald-500"},null,40,ks),u[7]||(u[7]=e("label",{for:"cb-invoice-company",class:"text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer"}," Facture au nom de l'entreprise ",-1))])):H("",!0),e("div",_s,[e("label",ws,[S(a(bt),{class:"w-3 h-3 md:w-3.5 md:h-3.5"}),u[8]||(u[8]=e("span",null,"Adresse",-1))]),me(e("input",{"onUpdate:modelValue":u[2]||(u[2]=n=>a(m).address=n),type:"text",placeholder:"123 Rue de la Paix",class:"w-full px-3 md:px-4 py-2.5 md:py-3 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 border border-gray-300 rounded-xl text-xs md:text-sm font-medium focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30 hover:border-gray-400 transition-all"},null,512),[[pe,a(m).address]])]),e("div",Cs,[e("div",$s,[u[9]||(u[9]=e("label",{class:"block text-[10px] md:text-xs text-gray-600 dark:text-gray-400 font-semibold uppercase tracking-wider"}," Ville ",-1)),me(e("input",{"onUpdate:modelValue":u[3]||(u[3]=n=>a(m).city=n),type:"text",placeholder:"Paris",class:"w-full px-3 md:px-4 py-2.5 md:py-3 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 border border-gray-300 rounded-xl text-xs md:text-sm font-medium focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30 hover:border-gray-400 transition-all"},null,512),[[pe,a(m).city]])]),e("div",Ss,[u[10]||(u[10]=e("label",{class:"block text-[10px] md:text-xs text-gray-600 dark:text-gray-400 font-semibold uppercase tracking-wider"}," CP ",-1)),e("input",{value:a(m).postalCode,type:"text",inputmode:"numeric",maxlength:a(Ze).postalCode,placeholder:"75001",class:"w-full px-3 md:px-4 py-2.5 md:py-3 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 border border-gray-300 rounded-xl text-xs md:text-sm font-medium focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30 hover:border-gray-400 transition-all",onInput:u[4]||(u[4]=n=>Z(n.target.value))},null,40,Ts)])]),e("div",Ps,[u[11]||(u[11]=e("label",{class:"block text-[10px] md:text-xs text-gray-600 dark:text-gray-400 font-semibold uppercase tracking-wider"}," Notes ",-1)),me(e("textarea",{"onUpdate:modelValue":u[5]||(u[5]=n=>a(m).notes=n),placeholder:"Commentaires, préférences...",rows:"2",class:"w-full px-3 md:px-4 py-2.5 md:py-3 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 dark:placeholder-gray-400 border border-gray-300 rounded-xl text-xs md:text-sm font-medium focus:outline-none focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10 dark:focus:border-emerald-500 dark:focus:ring-emerald-500/30 hover:border-gray-400 transition-all resize-none"},null,512),[[pe,a(m).notes]])])]),e("div",Es,[e("div",Is,[e("button",{onClick:x,disabled:!a(E),class:"btn-secondary text-[10px] md:text-xs px-2 md:px-4 py-2.5 md:py-3"},[S(a(yt),{class:"w-3.5 h-3.5 md:w-4 md:h-4"}),u[12]||(u[12]=e("span",{class:"hidden sm:inline"},"Historique",-1))],8,Ms),e("button",{onClick:M,disabled:!a(P),class:K(["inline-flex items-center justify-center gap-1 md:gap-2 px-2 md:px-4 py-2.5 md:py-3 text-[10px] md:text-xs font-medium rounded-xl transition-all duration-200",a(P)?"bg-white border border-gray-300 text-red-600 hover:bg-red-50 hover:border-red-200 dark:bg-gray-700 dark:border-gray-600 dark:text-red-400 dark:hover:bg-red-900/30 dark:hover:border-red-800":"bg-gray-100 text-gray-400 cursor-not-allowed border border-gray-200 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-500"])},[S(a(rt),{class:"w-3.5 h-3.5 md:w-4 md:h-4"}),u[13]||(u[13]=e("span",{class:"hidden sm:inline"},"Effacer",-1))],10,qs),e("button",{onClick:z,disabled:!a(P),class:K(["btn-primary text-[10px] md:text-xs px-2 md:px-4 py-2.5 md:py-3",a(E)?"bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-500":"bg-emerald-600 hover:bg-emerald-700 dark:bg-emerald-600 dark:hover:bg-emerald-500"])},[(s(),de(Pe(a(E)?a(ft):a(We)),{class:"w-3.5 h-3.5 md:w-4 md:h-4"})),e("span",js,y(a(E)?"Modifier":"Créer"),1)],10,Ns)])])]))}}),Fs={class:"flex-1 flex flex-col lg:flex-row gap-4 p-4 lg:gap-6 lg:p-6 pb-20 lg:pb-6"},Vs={class:"lg:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg z-50"},Rs={class:"flex"},Ds=["onClick"],Bs={class:"text-xs font-medium"},to=ge({__name:"CaissePage",setup(q){const m=I("services"),E=[{id:"services",label:"Services",icon:vt},{id:"ticket",label:"Ticket",icon:Et},{id:"client",label:"Client",icon:qt}];return(B,N)=>(s(),d(Y,null,[e("main",Fs,[e("aside",{class:K(["lg:w-80 lg:flex-shrink-0",m.value==="ticket"?"block":"hidden lg:block"])},[S(Ra)],2),e("section",{class:K(["flex-1 min-w-0",m.value==="services"?"block":"hidden lg:block"])},[S(ss)],2),e("aside",{class:K(["lg:w-80 xl:w-96 lg:flex-shrink-0",m.value==="client"?"block":"hidden lg:block"])},[S(As)],2)]),e("nav",Vs,[e("div",Rs,[(s(),d(Y,null,ae(E,P=>e("button",{key:P.id,onClick:O=>m.value=P.id,class:K(["flex-1 flex flex-col items-center justify-center py-3 transition-colors",m.value===P.id?"text-gray-900 bg-gray-100 dark:text-gray-100 dark:bg-gray-700":"text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:bg-gray-700/70"])},[(s(),de(Pe(P.icon),{class:"w-5 h-5 mb-1"})),e("span",Bs,y(P.label),1)],10,Ds)),64))])])],64))}});export{to as default};
