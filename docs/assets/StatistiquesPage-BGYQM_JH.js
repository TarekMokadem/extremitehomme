import{c as J,d as nt,r as m,a as I,C as lt,e as n,f as t,j as y,n as O,g as u,F as D,k as R,m as P,l as F,o as U,t as r,J as dt,U as it,h as M,s as x,K as E,q as o}from"./index-DlgJK6M0.js";import{R as W}from"./refresh-cw-jMjeuc1p.js";import{E as ct}from"./euro-B53o3jEP.js";import{S as ut}from"./shopping-bag-DXBfQZMI.js";import{C as gt}from"./clock-rwr5KbxI.js";const mt=J("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);const z=J("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);const G=J("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),xt={class:"flex-1 p-4 lg:p-6 overflow-auto bg-gray-50 dark:bg-gray-900"},yt={class:"max-w-7xl mx-auto space-y-6"},ht={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},_t=["disabled"],pt={key:0,class:"flex items-center justify-center py-20"},vt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},bt={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},ft={class:"flex items-center justify-between mb-3"},kt={class:"w-10 h-10 rounded-xl bg-emerald-100 dark:bg-emerald-900/40 flex items-center justify-center"},wt={class:"text-2xl font-bold text-gray-900 dark:text-white"},Tt={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},St={class:"flex items-center justify-between mb-3"},Dt={class:"w-10 h-10 rounded-xl bg-blue-100 dark:bg-blue-900/40 flex items-center justify-center"},jt={class:"text-2xl font-bold text-gray-900 dark:text-white"},$t={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},Ct={class:"flex items-center justify-between mb-3"},qt={class:"w-10 h-10 rounded-xl bg-purple-100 dark:bg-purple-900/40 flex items-center justify-center"},At={class:"text-2xl font-bold text-gray-900 dark:text-white"},It={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},Ot={class:"flex items-center justify-between mb-3"},Ft={class:"w-10 h-10 rounded-xl bg-amber-100 dark:bg-amber-900/40 flex items-center justify-center"},Mt={class:"text-2xl font-bold text-gray-900 dark:text-white"},Lt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Vt={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},Bt={class:"space-y-3"},Rt={class:"w-16 text-xs text-gray-500 dark:text-gray-400 shrink-0"},Et={class:"flex-1 h-8 bg-gray-100 dark:bg-gray-700 rounded-lg overflow-hidden relative"},Jt={key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs font-semibold text-gray-700 dark:text-gray-200"},Nt={class:"w-12 text-xs text-gray-400 dark:text-gray-500 text-right shrink-0"},Pt={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},Ut={class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider mb-4 flex items-center gap-2"},Wt={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},zt={key:1,class:"space-y-3"},Gt={class:"flex-1 min-w-0"},Kt={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},Ht={class:"h-2 bg-gray-100 dark:bg-gray-700 rounded-full mt-1 overflow-hidden"},Qt={class:"text-right shrink-0"},Xt={class:"text-sm font-bold text-gray-900 dark:text-white"},Yt={class:"text-xs text-gray-500 dark:text-gray-400"},Zt={class:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700"},te={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},ee={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},ae={class:"flex-1 min-w-0"},se={class:"font-semibold text-gray-900 dark:text-white truncate"},re={class:"text-sm text-gray-500 dark:text-gray-400"},oe={class:"text-right"},ne={class:"text-lg font-bold text-gray-900 dark:text-white"},le={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},de={class:"p-5 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between"},ie={class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider flex items-center gap-2"},ce={class:"text-sm text-gray-500 dark:text-gray-400"},ue={key:0,class:"p-8 text-center text-gray-500 dark:text-gray-400"},ge={key:1,class:"divide-y divide-gray-100 dark:divide-gray-700 max-h-96 overflow-y-auto"},me={class:"w-14 text-center shrink-0"},xe={class:"text-sm font-semibold text-gray-900 dark:text-white"},ye={class:"flex-1 min-w-0"},he={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},_e={class:"text-xs text-gray-500 dark:text-gray-400"},pe={class:"text-lg font-bold text-gray-900 dark:text-white shrink-0"},Se=nt({__name:"StatistiquesPage",setup(ve){const v=m(!0),b=m({total:0,count:0,avgTicket:0}),L=m({total:0,count:0,avgTicket:0}),K=m({total:0,count:0,avgTicket:0}),j=m(0),$=m(0),V=m([]),f=m([]),C=m([]),k=m([]),q=I(()=>j.value===0?0:(b.value.total-j.value)/j.value*100),A=I(()=>$.value===0?0:(L.value.total-$.value)/$.value*100),H=I(()=>Math.max(...V.value.map(s=>s.total),1)),Q=I(()=>Math.max(...f.value.map(s=>s.count),1)),N=async()=>{v.value=!0;try{const s=new Date,a=s.toISOString().split("T")[0],e=new Date(s.getTime()-1440*60*1e3).toISOString().split("T")[0],l=new Date(s.getTime()-10080*60*1e3).toISOString().split("T")[0],c=new Date(s.getTime()-336*60*60*1e3).toISOString().split("T")[0],_=new Date(s.getTime()-720*60*60*1e3).toISOString().split("T")[0],{data:p}=await x.from("sales").select("total").gte("created_at",`${a}T00:00:00`).eq("status","completed"),g=p||[];b.value={total:g.reduce((d,i)=>d+i.total,0),count:g.length,avgTicket:g.length>0?g.reduce((d,i)=>d+i.total,0)/g.length:0};const{data:w}=await x.from("sales").select("total").gte("created_at",`${e}T00:00:00`).lt("created_at",`${a}T00:00:00`).eq("status","completed");j.value=(w||[]).reduce((d,i)=>d+i.total,0);const{data:B}=await x.from("sales").select("total").gte("created_at",`${l}T00:00:00`).eq("status","completed"),T=B||[];L.value={total:T.reduce((d,i)=>d+i.total,0),count:T.length,avgTicket:T.length>0?T.reduce((d,i)=>d+i.total,0)/T.length:0};const{data:rt}=await x.from("sales").select("total").gte("created_at",`${c}T00:00:00`).lt("created_at",`${l}T00:00:00`).eq("status","completed");$.value=(rt||[]).reduce((d,i)=>d+i.total,0);const{data:ot}=await x.from("sales").select("total").gte("created_at",`${_}T00:00:00`).eq("status","completed"),S=ot||[];K.value={total:S.reduce((d,i)=>d+i.total,0),count:S.length,avgTicket:S.length>0?S.reduce((d,i)=>d+i.total,0)/S.length:0},await X(),await Y(),await Z(),await tt()}catch(s){console.error("Erreur chargement stats:",s)}finally{v.value=!1}},X=async()=>{const s=[],a=new Date;for(let e=6;e>=0;e--){const l=new Date(a.getTime()-e*24*60*60*1e3),c=l.toISOString().split("T")[0],_=new Date(l.getTime()+1440*60*1e3).toISOString().split("T")[0],{data:p}=await x.from("sales").select("total").gte("created_at",`${c}T00:00:00`).lt("created_at",`${_}T00:00:00`).eq("status","completed"),g=p||[];s.push({date:c,total:g.reduce((w,B)=>w+B.total,0),count:g.length})}V.value=s},Y=async()=>{const{data:s}=await x.from("sale_items").select("product_name, quantity, subtotal_ttc");if(!s){f.value=[];return}const a=new Map;for(const e of s){const l=a.get(e.product_name);l?(l.count+=e.quantity,l.revenue+=e.subtotal_ttc):a.set(e.product_name,{name:e.product_name,count:e.quantity,revenue:e.subtotal_ttc})}f.value=Array.from(a.values()).sort((e,l)=>l.count-e.count).slice(0,5)},Z=async()=>{const{data:s}=await x.from("vendors").select("id, first_name, last_name, initials, color").eq("is_active",!0);if(!s){C.value=[];return}const a=new Date,e=new Date(a.getTime()-720*60*60*1e3).toISOString().split("T")[0],l=[];for(const c of s){const{data:_}=await x.from("sales").select("total").eq("vendor_id",c.id).gte("created_at",`${e}T00:00:00`).eq("status","completed"),p=_||[];l.push({id:c.id,name:`${c.first_name} ${c.last_name}`,initials:c.initials??"",color:c.color??"#6B7280",total:p.reduce((g,w)=>g+w.total,0),count:p.length})}C.value=l.sort((c,_)=>_.total-c.total)},tt=async()=>{const s=new Date().toISOString().split("T")[0],{data:a}=await x.from("sales").select(`
      id,
      ticket_number,
      total,
      created_at,
      client:clients(first_name, last_name),
      vendor:vendors(first_name, last_name),
      items:sale_items(id)
    `).gte("created_at",`${s}T00:00:00`).eq("status","completed").order("created_at",{ascending:!1});if(!a){k.value=[];return}k.value=a.map(e=>({id:e.id,ticket_number:e.ticket_number,total:e.total,created_at:e.created_at,client_name:e.client?`${e.client.first_name} ${e.client.last_name}`:null,vendor_name:e.vendor?`${e.vendor.first_name} ${e.vendor.last_name}`:"Inconnu",items_count:e.items?.length||0}))},h=s=>s.toFixed(2),et=s=>new Date(s).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric"}),at=s=>new Date(s).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),st=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"});return lt(N),(s,a)=>(o(),n("main",xt,[t("div",yt,[t("div",ht,[a[1]||(a[1]=t("div",null,[t("h1",{class:"text-xl lg:text-2xl font-bold text-gray-900 dark:text-white"},"Statistiques"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"Vue d'ensemble de l'activité")],-1)),t("button",{onClick:N,disabled:v.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 dark:bg-emerald-600 dark:hover:bg-emerald-500 text-white rounded-xl hover:bg-gray-800 transition-colors disabled:opacity-50"},[y(u(W),{class:O(["w-4 h-4",v.value&&"animate-spin"])},null,8,["class"]),a[0]||(a[0]=t("span",null,"Actualiser",-1))],8,_t)]),v.value?(o(),n("div",pt,[y(u(W),{class:"w-8 h-8 text-gray-400 animate-spin"})])):(o(),n(D,{key:1},[t("div",vt,[t("div",bt,[t("div",ft,[t("div",kt,[y(u(ct),{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})]),q.value!==0?(o(),n("div",{key:0,class:O(["inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",q.value>0?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"])},[(o(),P(U(q.value>0?u(G):u(z)),{class:"w-3 h-3"})),F(" "+r(Math.abs(q.value).toFixed(0))+"% ",1)],2)):R("",!0)]),t("p",wt,r(h(b.value.total))+"€",1),a[2]||(a[2]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"CA aujourd'hui",-1))]),t("div",Tt,[t("div",St,[t("div",Dt,[y(u(dt),{class:"w-5 h-5 text-blue-600 dark:text-blue-400"})]),A.value!==0?(o(),n("div",{key:0,class:O(["inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",A.value>0?"bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300":"bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-300"])},[(o(),P(U(A.value>0?u(G):u(z)),{class:"w-3 h-3"})),F(" "+r(Math.abs(A.value).toFixed(0))+"% ",1)],2)):R("",!0)]),t("p",jt,r(h(L.value.total))+"€",1),a[3]||(a[3]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"CA cette semaine",-1))]),t("div",$t,[t("div",Ct,[t("div",qt,[y(u(ut),{class:"w-5 h-5 text-purple-600 dark:text-purple-400"})])]),t("p",At,r(b.value.count),1),a[4]||(a[4]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"Ventes aujourd'hui",-1))]),t("div",It,[t("div",Ot,[t("div",Ft,[y(u(it),{class:"w-5 h-5 text-amber-600 dark:text-amber-400"})])]),t("p",Mt,r(h(b.value.avgTicket))+"€",1),a[5]||(a[5]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"Panier moyen",-1))])]),t("div",Lt,[t("div",Vt,[a[6]||(a[6]=t("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider mb-4"}," Chiffre d'affaires (7 derniers jours) ",-1)),t("div",Bt,[(o(!0),n(D,null,M(V.value,e=>(o(),n("div",{key:e.date,class:"flex items-center gap-3"},[t("span",Rt,r(et(e.date)),1),t("div",Et,[t("div",{class:"h-full bg-gradient-to-r from-emerald-500 to-emerald-400 dark:from-emerald-600 dark:to-emerald-500 rounded-lg transition-all duration-500",style:E({width:`${e.total/H.value*100}%`})},null,4),e.total>0?(o(),n("span",Jt,r(h(e.total))+"€ ",1)):R("",!0)]),t("span",Nt,r(e.count)+" v.",1)]))),128))])]),t("div",Pt,[t("h3",Ut,[y(u(mt),{class:"w-4 h-4 text-amber-500 dark:text-amber-400"}),a[7]||(a[7]=F(" Top 5 Services ",-1))]),f.value.length===0?(o(),n("div",Wt," Aucune donnée ")):(o(),n("div",zt,[(o(!0),n(D,null,M(f.value,(e,l)=>(o(),n("div",{key:e.name,class:"flex items-center gap-3"},[t("span",{class:O(["w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold",l===0?"bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300":"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"])},r(l+1),3),t("div",Gt,[t("p",Kt,r(e.name),1),t("div",Ht,[t("div",{class:"h-full bg-gradient-to-r from-purple-500 to-purple-400 dark:from-purple-600 dark:to-purple-500 rounded-full",style:E({width:`${e.count/Q.value*100}%`})},null,4)])]),t("div",Qt,[t("p",Xt,r(e.count),1),t("p",Yt,r(h(e.revenue))+"€",1)])]))),128))]))])]),t("div",Zt,[a[8]||(a[8]=t("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider mb-4"}," Performance vendeurs (30 derniers jours) ",-1)),C.value.length===0?(o(),n("div",te," Aucune donnée ")):(o(),n("div",ee,[(o(!0),n(D,null,M(C.value,e=>(o(),n("div",{key:e.id,class:"flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl"},[t("div",{style:E({backgroundColor:e.color}),class:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold"},r(e.initials),5),t("div",ae,[t("p",se,r(e.name),1),t("p",re,r(e.count)+" ventes",1)]),t("div",oe,[t("p",ne,r(h(e.total))+"€",1)])]))),128))]))]),t("div",le,[t("div",de,[t("h3",ie,[y(u(gt),{class:"w-4 h-4 dark:text-gray-400"}),F(" Journal des ventes — "+r(st(new Date().toISOString())),1)]),t("span",ce,r(k.value.length)+" ventes",1)]),k.value.length===0?(o(),n("div",ue," Aucune vente aujourd'hui ")):(o(),n("div",ge,[(o(!0),n(D,null,M(k.value,e=>(o(),n("div",{key:e.id,class:"px-5 py-3 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"},[t("div",me,[t("p",xe,r(at(e.created_at)),1)]),t("div",ye,[t("p",he,r(e.client_name||"Client anonyme"),1),t("p",_e,r(e.ticket_number)+" · "+r(e.items_count)+" article(s) · "+r(e.vendor_name),1)]),t("p",pe,r(h(e.total))+"€",1)]))),128))]))])],64))])]))}});export{Se as default};
