import{d as W,r as y,a as l,e as d,f as t,k as P,j as u,l as q,g as c,y as X,G as Z,F as p,h as m,m as R,Q as tt,t as s,U as et,s as at,n as rt,q as n}from"./index-CmA_YBSG.js";import{P as st}from"./printer-Cpz3rRt9.js";import{R as E}from"./refresh-cw-DrNKGNc5.js";import{T as ot}from"./trending-up-Cvd8hqb_.js";import{R as F}from"./receipt-DVC2SMtU.js";import{S as nt}from"./shopping-cart-TQbJuF1Z.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const lt={class:"flex-1 p-4 lg:p-6 overflow-auto bg-gray-50 dark:bg-gray-900 print:bg-white print:p-4"},it={class:"max-w-6xl mx-auto space-y-6 print:max-w-none"},ct={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 print:flex-row"},gt={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 space-y-4 print:hidden"},ut={class:"flex flex-wrap items-center gap-3"},pt=["value"],xt={class:"flex flex-wrap gap-2"},yt=["onClick"],mt=["disabled"],bt={class:"hidden print:block text-center mb-4"},ht={class:"text-lg font-bold"},ft={key:0,class:"flex justify-center py-12"},_t={class:"grid grid-cols-2 lg:grid-cols-4 gap-4 print:grid-cols-4"},kt={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 print:rounded-none print:shadow-none"},vt={class:"flex items-center gap-2 mb-1"},wt={class:"text-2xl font-bold text-gray-900 dark:text-white print:text-black"},St={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 print:rounded-none print:shadow-none"},Ct={class:"flex items-center gap-2 mb-1"},$t={class:"text-2xl font-bold text-gray-900 dark:text-white print:text-black"},Mt={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 print:rounded-none print:shadow-none"},Tt={class:"flex items-center gap-2 mb-1"},Dt={class:"text-2xl font-bold text-gray-900 dark:text-white print:text-black"},At={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 print:rounded-none print:shadow-none"},Nt={class:"flex items-center gap-2 mb-1"},Pt={class:"text-2xl font-bold text-gray-900 dark:text-white print:text-black"},qt={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden print:rounded-none print:border print:shadow-none"},Rt={class:"w-full text-sm"},Et={class:"divide-y divide-gray-100 dark:divide-gray-700"},Ft={class:"px-4 py-2"},Ot={class:"px-4 py-2 text-right tabular-nums"},Vt={class:"px-4 py-2 text-right tabular-nums"},jt={class:"font-bold bg-gray-50 dark:bg-gray-700/50 border-t-2 border-gray-200 dark:border-gray-600"},Bt={class:"px-4 py-2 text-right tabular-nums"},Jt={class:"px-4 py-2 text-right tabular-nums"},Lt={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden print:rounded-none print:border print:shadow-none"},Ht={class:"px-4 py-3 bg-gray-100 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"},Yt={class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider"},Ut={key:0,class:"p-8 text-center"},Gt={key:1,class:"overflow-x-auto journal-content print-thermal-compact"},zt={class:"w-full text-sm min-w-[900px]"},It={class:"bg-gray-100 dark:bg-gray-700/60"},Qt={colspan:"8",class:"px-3 py-2 font-semibold text-gray-800 dark:text-gray-200 text-xs uppercase tracking-wider"},Kt={class:"px-3 py-2 tabular-nums"},Wt={class:"px-3 py-2 tabular-nums"},Xt={class:"px-3 py-2 font-mono text-xs"},Zt={class:"px-3 py-2"},te={class:"px-3 py-2"},ee=["title"],ae={class:"px-3 py-2"},re={class:"px-3 py-2 text-right tabular-nums font-medium"},se={class:"bg-gray-50 dark:bg-gray-700/30 border-b-2 border-gray-200 dark:border-gray-600"},oe={colspan:"7",class:"px-3 py-2 text-right text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider"},ne={class:"px-3 py-2 text-right tabular-nums font-bold text-gray-900 dark:text-white"},de={class:"bg-gray-900 dark:bg-emerald-900/40"},le={colspan:"7",class:"px-3 py-3 text-right font-bold text-white dark:text-emerald-300 uppercase tracking-wider text-sm"},ie={class:"px-3 py-3 text-right tabular-nums font-bold text-white dark:text-emerald-300 text-lg"},ce=W({__name:"RecapMensuelPage",setup(ge){const _={cash:"Espèces",card:"CB",contactless:"Sans contact",amex:"Amex",check:"Chèque",gift_card:"Chèque Cadeau",free:"Gratuit",technical:"Technique"},k=Object.keys(_),O=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],V=["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"],T=new Date,b=y(T.getFullYear()),h=y(T.getMonth()),x=y(!1),i=y([]),v=y(!1),j=l(()=>{const a=new Date().getFullYear();return[a-2,a-1,a,a+1]}),w=l(()=>`${O[h.value]} ${b.value}`),S=l(()=>i.value.reduce((a,e)=>a+e.total,0)),C=l(()=>i.value.length),B=l(()=>C.value>0?S.value/C.value:0),J=l(()=>{const a=new Set;for(const e of i.value)e.client&&a.add(`${e.client.first_name}_${e.client.last_name}`);return a.size}),$=l(()=>{const a={};for(const e of k)a[e]={amount:0,count:0};for(const e of i.value)if(e.payments)for(const r of e.payments)a[r.method]||(a[r.method]={amount:0,count:0}),a[r.method].amount+=r.amount,a[r.method].count++;return k.map(e=>({method:e,label:_[e]??e,amount:a[e]?.amount??0,count:a[e]?.count??0})).filter(e=>e.count>0||k.includes(e.method))}),L=l(()=>$.value.reduce((a,e)=>a+e.amount,0)),H=l(()=>$.value.reduce((a,e)=>a+e.count,0)),Y=l(()=>{const a=new Map;for(const r of i.value){const o=D(r.created_at);a.has(o)||a.set(o,[]),a.get(o).push(r)}const e=[];for(const[r,o]of a)e.push({date:r,label:r,sales:o,subtotal:o.reduce((f,M)=>f+M.total,0)});return e});function D(a){const e=new Date(a);return`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`}function U(a){const e=new Date(a);return`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function g(a){return a.toFixed(2)}function G(a){return!a||a.length===0?"—":a.map(e=>_[e.method]??e.method).join(", ")}function A(a){return!a||a.length===0?"—":a.map(e=>`${e.quantity}x ${e.product_name}`).join(", ")}function z(a){return a&&`${a.first_name} ${a.last_name}`.trim()||"—"}function I(a){return a&&`${a.first_name} ${a.last_name}`.trim()||"—"}async function Q(){x.value=!0;try{const a=b.value,e=h.value,r=`${a}-${String(e+1).padStart(2,"0")}-01`,o=new Date(a,e+1,0).getDate(),f=`${a}-${String(e+1).padStart(2,"0")}-${String(o).padStart(2,"0")}`,{data:M,error:N}=await at.from("sales").select(`
        id, ticket_number, total, discount_amount, created_at,
        client:clients(first_name, last_name),
        vendor:vendors(first_name, last_name),
        items:sale_items(id, product_name, quantity, subtotal_ttc),
        payments:payments(method, amount)
      `).gte("created_at",`${r}T00:00:00`).lte("created_at",`${f}T23:59:59`).eq("status","completed").order("created_at");if(N)throw N;i.value=M||[]}catch(a){console.error("Erreur chargement recap mensuel:",a),i.value=[]}finally{x.value=!1,v.value=!0}}function K(){window.print()}return(a,e)=>(n(),d("main",lt,[t("div",it,[t("div",ct,[e[2]||(e[2]=t("h1",{class:"text-xl lg:text-2xl font-bold text-gray-900 dark:text-white print:text-black"}," Récapitulatif Mensuel ",-1)),v.value&&i.value.length>0?(n(),d("button",{key:0,onClick:K,class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 dark:bg-emerald-600 text-white rounded-xl hover:bg-gray-800 dark:hover:bg-emerald-500 transition-colors print:hidden"},[u(c(st),{class:"w-4 h-4"}),e[1]||(e[1]=q(" Imprimer ",-1))])):P("",!0)]),t("div",gt,[t("div",ut,[e[3]||(e[3]=t("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Année :",-1)),X(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>b.value=r),class:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-900/10 dark:focus:ring-emerald-500/30"},[(n(!0),d(p,null,m(j.value,r=>(n(),d("option",{key:r,value:r},s(r),9,pt))),128))],512),[[Z,b.value,void 0,{number:!0}]])]),t("div",xt,[(n(),d(p,null,m(V,(r,o)=>t("button",{key:o,onClick:f=>h.value=o,class:rt(["px-3 py-2 text-sm font-medium rounded-xl transition-colors",h.value===o?"bg-gray-900 dark:bg-emerald-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},s(r),11,yt)),64))]),t("button",{onClick:Q,disabled:x.value,class:"inline-flex items-center gap-2 px-5 py-2.5 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 disabled:opacity-50 transition-colors font-medium"},[x.value?(n(),R(c(E),{key:1,class:"w-4 h-4 animate-spin"})):(n(),R(c(tt),{key:0,class:"w-4 h-4"})),e[4]||(e[4]=q(" Calculer ",-1))],8,mt)]),t("div",bt,[t("p",ht,s(w.value),1)]),x.value?(n(),d("div",ft,[u(c(E),{class:"w-8 h-8 text-gray-400 animate-spin"})])):v.value?(n(),d(p,{key:1},[t("div",_t,[t("div",kt,[t("div",vt,[u(c(ot),{class:"w-4 h-4 text-emerald-500"}),e[5]||(e[5]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold"},"Total CA",-1))]),t("p",wt,s(g(S.value))+" €",1)]),t("div",St,[t("div",Ct,[u(c(F),{class:"w-4 h-4 text-blue-500"}),e[6]||(e[6]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold"},"Ventes",-1))]),t("p",$t,s(C.value),1)]),t("div",Mt,[t("div",Tt,[u(c(nt),{class:"w-4 h-4 text-orange-500"}),e[7]||(e[7]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold"},"Panier moyen",-1))]),t("p",Dt,s(g(B.value))+" €",1)]),t("div",At,[t("div",Nt,[u(c(et),{class:"w-4 h-4 text-purple-500"}),e[8]||(e[8]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold"},"Clients uniques",-1))]),t("p",Pt,s(J.value),1)])]),t("div",qt,[e[11]||(e[11]=t("div",{class:"px-4 py-3 bg-gray-100 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"},[t("h2",{class:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider"},"Récapitulatif par mode de règlement")],-1)),t("table",Rt,[e[10]||(e[10]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-600"},[t("th",{class:"px-4 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Mode de règlement"),t("th",{class:"px-4 py-2 text-right font-semibold text-gray-700 dark:text-gray-300"},"Montant"),t("th",{class:"px-4 py-2 text-right font-semibold text-gray-700 dark:text-gray-300"},"Nb")])],-1)),t("tbody",Et,[(n(!0),d(p,null,m($.value,r=>(n(),d("tr",{key:r.method,class:"text-gray-900 dark:text-gray-100"},[t("td",Ft,s(r.label),1),t("td",Ot,s(g(r.amount))+" €",1),t("td",Vt,s(r.count),1)]))),128)),t("tr",jt,[e[9]||(e[9]=t("td",{class:"px-4 py-2"},"Total",-1)),t("td",Bt,s(g(L.value))+" €",1),t("td",Jt,s(H.value),1)])])])]),t("div",Lt,[t("div",Ht,[t("h2",Yt," Journal des ventes — "+s(w.value),1)]),i.value.length===0?(n(),d("div",Ut,[u(c(F),{class:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto"}),e[12]||(e[12]=t("p",{class:"text-gray-500 dark:text-gray-400 mt-2"},"Aucune vente pour ce mois",-1))])):(n(),d("div",Gt,[t("table",zt,[e[13]||(e[13]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-600"},[t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Date"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Heure"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Ticket"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Client"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Vendeur"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Articles"),t("th",{class:"px-3 py-2 text-left font-semibold text-gray-700 dark:text-gray-300"},"Paiement"),t("th",{class:"px-3 py-2 text-right font-semibold text-gray-700 dark:text-gray-300"},"Total")])],-1)),t("tbody",null,[(n(!0),d(p,null,m(Y.value,r=>(n(),d(p,{key:r.date},[t("tr",It,[t("td",Qt,s(r.label),1)]),(n(!0),d(p,null,m(r.sales,o=>(n(),d("tr",{key:o.id,class:"text-gray-900 dark:text-gray-100 border-b border-gray-50 dark:border-gray-700/40 hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors"},[t("td",Kt,s(D(o.created_at)),1),t("td",Wt,s(U(o.created_at)),1),t("td",Xt,s(o.ticket_number),1),t("td",Zt,s(z(o.client)),1),t("td",te,s(I(o.vendor)),1),t("td",{class:"px-3 py-2 max-w-[200px] truncate",title:A(o.items)},s(A(o.items)),9,ee),t("td",ae,s(G(o.payments)),1),t("td",re,s(g(o.total))+" €",1)]))),128)),t("tr",se,[t("td",oe," Sous-total "+s(r.label),1),t("td",ne,s(g(r.subtotal))+" € ",1)])],64))),128)),t("tr",de,[t("td",le," Total "+s(w.value),1),t("td",ie,s(g(S.value))+" € ",1)])])])]))])],64)):P("",!0)])]))}}),fe=dt(ce,[["__scopeId","data-v-aa8e9f2b"]]);export{fe as default};
