import{d as T,r as f,a as k,o as q,e as l,f as e,j as y,l as _,g as p,P as H,n as C,F as v,k as F,h as R,t as s,s as V,v as n}from"./index-8JeweAIN.js";import{R as w}from"./refresh-cw--HoeajCP.js";const P={class:"flex-1 p-4 lg:p-6 overflow-auto bg-gray-50 dark:bg-gray-900"},L={class:"max-w-6xl mx-auto space-y-6"},N={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},S={class:"text-xl lg:text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2"},B=["disabled"],D={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},j={key:0,class:"flex justify-center py-20"},M={class:"overflow-x-auto"},A={class:"w-full text-left"},E={class:"divide-y divide-gray-100 dark:divide-gray-700"},z={class:"px-4 py-3 font-medium text-gray-900 dark:text-white"},G={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400 text-right tabular-nums"},I={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400 text-right tabular-nums"},J={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400 text-right tabular-nums"},K={class:"bg-gray-50 dark:bg-gray-700 border-t-2 border-gray-200 dark:border-gray-600"},O={class:"px-4 py-3 font-bold text-gray-900 dark:text-white text-right tabular-nums"},Q={class:"px-4 py-3 font-bold text-gray-900 dark:text-white text-right tabular-nums"},U={class:"px-4 py-3 font-bold text-gray-900 dark:text-white text-right tabular-nums"},W={key:0,class:"p-8 text-center text-gray-500 dark:text-gray-400"},$=T({__name:"ValeurTheoriquePage",setup(X){const o=f(!1),d=f([]),g=k(()=>{const a=new Map;for(const t of d.value){const r=t.brand?.trim()||"Sans marque",c=a.get(r),u=t.stock??0,h=(t.price_ht??0)*u,b=(t.price_ttc??0)*u;c?(c.count+=u,c.totalHt+=h,c.totalTtc+=b):a.set(r,{count:u,totalHt:h,totalTtc:b})}return Array.from(a.entries()).map(([t,r])=>({brand:t,count:r.count,totalHt:r.totalHt,totalTtc:r.totalTtc})).sort((t,r)=>t.brand.localeCompare(r.brand))}),x=k(()=>g.value.reduce((a,t)=>({count:a.count+t.count,totalHt:a.totalHt+t.totalHt,totalTtc:a.totalTtc+t.totalTtc}),{count:0,totalHt:0,totalTtc:0}));function i(a){return a.toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})}async function m(){o.value=!0;try{const{data:a,error:t}=await V.from("products").select("brand, price_ht, price_ttc, stock").eq("type","product");if(t)throw t;d.value=a??[]}catch(a){console.error("Erreur chargement valeur théorique:",a),d.value=[]}finally{o.value=!1}}return q(()=>m()),(a,t)=>(n(),l("main",P,[e("div",L,[e("div",N,[e("div",null,[e("h1",S,[y(p(H),{class:"w-7 h-7 text-gray-600 dark:text-gray-400"}),t[0]||(t[0]=_(" Valeur théorique du stock ",-1))]),t[1]||(t[1]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"}," Valeur totale du stock par marque (produits physiques uniquement) ",-1))]),e("button",{onClick:m,disabled:o.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 dark:bg-emerald-600 dark:hover:bg-emerald-500 text-white rounded-xl hover:bg-gray-800 transition-colors disabled:opacity-50"},[y(p(w),{class:C(["w-4 h-4",o.value&&"animate-spin"])},null,8,["class"]),t[2]||(t[2]=_(" Rafraîchir ",-1))],8,B)]),e("div",D,[o.value&&d.value.length===0?(n(),l("div",j,[y(p(w),{class:"w-8 h-8 text-gray-400 dark:text-gray-500 animate-spin"})])):(n(),l(v,{key:1},[e("div",M,[e("table",A,[t[4]||(t[4]=e("thead",{class:"bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"},[e("tr",null,[e("th",{class:"px-4 py-3 text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider"}," Marque "),e("th",{class:"px-4 py-3 text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider text-right"}," Nombre de produits "),e("th",{class:"px-4 py-3 text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider text-right"}," Prix HT total "),e("th",{class:"px-4 py-3 text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider text-right"}," Prix TTC total ")])],-1)),e("tbody",E,[(n(!0),l(v,null,R(g.value,r=>(n(),l("tr",{key:r.brand,class:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"},[e("td",z,s(r.brand),1),e("td",G,s(r.count.toLocaleString("fr-FR")),1),e("td",I,s(i(r.totalHt))+" € ",1),e("td",J,s(i(r.totalTtc))+" € ",1)]))),128))]),e("tfoot",K,[e("tr",null,[t[3]||(t[3]=e("td",{class:"px-4 py-3 font-bold text-gray-900 dark:text-white"}," Total ",-1)),e("td",O,s(x.value.count.toLocaleString("fr-FR")),1),e("td",Q,s(i(x.value.totalHt))+" € ",1),e("td",U,s(i(x.value.totalTtc))+" € ",1)])])])]),!o.value&&g.value.length===0?(n(),l("p",W," Aucun produit physique en stock. ")):F("",!0)],64))])])]))}});export{$ as default};
